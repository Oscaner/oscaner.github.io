<!DOCTYPE html>
<html lang="en">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <meta name="baidu-site-verification" content="code-RlNzeiqm6B">
    
    
    <meta name="google-site-verification" content="clzGAgkJY2WD5IGr5G6KZS9xymJYL_IH2QIEettmobY">
    
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="description" content="心若浮沉，浅笑安然">
    <meta name="keywords" content="Kang Oscaner China Blog">
    <meta name="theme-color" content="#000000">
    <meta name="site" content="https://www.oscaner.com/">

    <!-- Open Graph -->
    <meta property="og:title" content="Drupal 配置开发 - Oscaner 的博客 | Oscaner Blog">
    
    <meta property="og:type" content="article">
    <meta property="og:description" content="基本概念
">
    
    <meta property="article:published_time" content=" 2019-06-30T14:02:00Z">
    
    
    <meta property="article:author" content="Oscaner">
    
    
    <meta property="article:tag" content="Skill">
    
    <meta property="article:tag" content="PHP">
    
    <meta property="article:tag" content="Drupal">
    
    
    <meta property="og:image" content="https://q2.qlogo.cn/headimg_dl?bs=2573226076&dst_uin=2573226076&spec=640&url_enc=0&referer=bu_interface&term_type=PC">
    <meta property="og:url" content="https://www.oscaner.com/skill/php/drupal-config.html">
    <meta property="og:site_name" content="Oscaner 的博客 | Oscaner Blog">

    <title>Drupal 配置开发 - Oscaner 的博客 | Oscaner Blog</title>

    <!-- Web App Manifest -->
    <link rel="manifest" href="/pwa/manifest.json">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/assets/img/favicon.ico">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://www.oscaner.com/skill/php/drupal-config.html">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/assets/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/assets/css/hux-blog.min.css">
    <link rel="stylesheet" href="/assets/css/oscaner-blog.min.css">

    <!-- Custom Fonts -->
    <!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <!-- <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <link href="/packages/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>

    <!-- Google AdSense -->
    <script data-ad-client="ca-pub-3286495153411959" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" crossorigin="anonymous"></script>

    <!-- MD5 -->
    <script src="/assets/js/md5.min.js"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-R9FFJYC4P1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-R9FFJYC4P1');
    </script>
    

</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->

    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">
                  
                    Oscaner
                  
                </a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div id="huxblog_navbar">
                <div class="navbar-collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="/">Home</a>
                        </li>
                        
                        
                        
                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                        
                        
                        
                        
                        <li>
                            <a href="/friends/">Friends</a>
                        </li>
                        
                        
                        
                        
                        
                        <li>
                            <a href="/projects/">Projects</a>
                        </li>
                        
                        
                        
                        
                        
                        <li>
                            <a href="/archive/">Archive</a>
                        </li>
                        
                        
                        
                        
                        
                        <li class="search-icon">
                            <a href="javascript:void(0)">
                                <i class="fa fa-search"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <script>
        // Drop Bootstarp low-performance Navbar
        // Use customize navbar with high-quality material design animation
        // in high-perf jank-free CSS3 implementation
        var $body = document.body;
        var $toggle = document.querySelector('.navbar-toggle');
        var $navbar = document.querySelector('#huxblog_navbar');
        var $collapse = document.querySelector('.navbar-collapse');

        var __HuxNav__ = {
            close: function () {
                $navbar.className = " ";
                // wait until animation end.
                setTimeout(function () {
                    // prevent frequently toggle
                    if ($navbar.className.indexOf('in') < 0) {
                        $collapse.style.height = "0px"
                    }
                }, 400)
            },
            open: function () {
                $collapse.style.height = "auto"
                $navbar.className += " in";
            }
        }

        // Bind Event
        $toggle.addEventListener('click', function (e) {
            if ($navbar.className.indexOf('in') > 0) {
                __HuxNav__.close()
            } else {
                __HuxNav__.open()
            }
        })

        /**
         * Since Fastclick is used to delegate 'touchstart' globally
         * to hack 300ms delay in iOS by performing a fake 'click',
         * Using 'e.stopPropagation' to stop 'touchstart' event from
         * $toggle/$collapse will break global delegation.
         *
         * Instead, we use a 'e.target' filter to prevent handler
         * added to document close HuxNav.
         *
         * Also, we use 'click' instead of 'touchstart' as compromise
         */
        document.addEventListener('click', function (e) {
            if (e.target == $toggle) return;
            if (e.target.className == 'icon-bar') return;
            __HuxNav__.close();
        })
    </script>

    <!-- Search -->
<div class="search-page">
  <div class="search-icon-close-container">
    <span class="search-icon-close">
      <i class="fa fa-chevron-down"></i>
    </span>
  </div>
  <div class="search-main container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <form></form>
        <input type="text" id="search-input" placeholder="$ grep...">
        
        <div id="search-results" class="mini-post-list"></div>
      </div>
    </div>
  </div>
</div>

    <!-- Image to hack wechat -->
<!-- <img src="/assets/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="/assets/img/post-bg-alitrip.jpg" width="0" height="0"> -->

<!-- Post Header -->



<style type="text/css">
    header.intro-header{
        position: relative;
        background-image: url('/assets/img/post-bg-alitrip.jpg');
        background: ;
    }

    
</style>




<header class="intro-header">

    <div class="header-mask"></div>
    
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/archive/?tag=Skill" title="Skill">Skill</a>
                        
                        <a class="tag" href="/archive/?tag=PHP" title="PHP">PHP</a>
                        
                        <a class="tag" href="/archive/?tag=Drupal" title="Drupal">Drupal</a>
                        
                    </div>
                    <h1>Drupal 配置开发</h1>
                    
                    <h2 class="subheading"></h2>
                    <span class="meta">Posted by Oscaner on June 30, 2019</span>
                </div>
            </div>
        </div>
    </div>
</header>







<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <!-- Multi-Lingual -->
                

                <h2 id="基本概念">基本概念</h2>

<p>配置文档见: <a href="https://www.drupal.org/docs/8/api/configuration-api/configuration-api-overview" class="web-link">Configuration API overview</a></p>

<p>配置 API 主要做配置数据的管理, 比如网站的站点名称等。</p>

<p>通常配置都是由开发人员创建的, 除了超级管理员可以在后台修改配置, 其它用户是没有操作权限的。</p>

<p>配置 API 有两种:</p>

<ol>
  <li>Config API</li>
  <li>Configuration Entity API</li>
</ol>

<p>其中, Config API 可以认为是一个单独的配置实例, 一般只保存简单的 Boolean 值、数字、字符串等, 如站点名称(site name)</p>

<p>Configuration Entity API 主要用来存储多个配置集, 例如节点类型、视图、词汇和字段等。</p>

<p>Drupal8 的配置信息默认是保存在数据库中, 配置文件格式是 YAML</p>

<h2 id="配置存储">配置存储</h2>

<h3 id="基础配置hello_worldsettingyml">基础配置(hello_world.setting.yml)</h3>

<p>以下是创建一个简单配置的示例:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td>
<td class="rouge-code"><pre><span class="o">&gt;</span> <span class="nb">cd </span>docroot/modules/custom/hello_world
<span class="o">&gt;</span> <span class="nb">mkdir</span> <span class="nt">-p</span> config/install
<span class="o">&gt;</span> <span class="nb">touch </span>config/install/hello_world.settings.yml
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>然后把以下代码写入到 <code class="language-plaintext highlighter-rouge">hello_world.settings.yml</code> 中</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td>
<td class="rouge-code"><pre><span class="na">some_string</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Woo</span><span class="nv"> </span><span class="s">kittens!'</span>
<span class="na">some_int</span><span class="pi">:</span> <span class="m">42</span>
<span class="na">some_bool</span><span class="pi">:</span> <span class="no">true</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>也可以定义一个嵌套的结构, 如:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td>
<td class="rouge-code"><pre><span class="na">name</span><span class="pi">:</span> <span class="s">thumbnail</span>
<span class="na">label</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Thumbnail</span><span class="nv"> </span><span class="s">(100*100)'</span>
<span class="na">effects</span><span class="pi">:</span>
  <span class="na">1cfec298-8620-4749-b100-ccb6c4500779</span><span class="pi">:</span>
    <span class="na">id</span><span class="pi">:</span> <span class="s">image_scale</span>
    <span class="na">data</span><span class="pi">:</span>
      <span class="na">width</span><span class="pi">:</span> <span class="m">100</span>
      <span class="na">height</span><span class="pi">:</span> <span class="m">100</span>
      <span class="na">upscale</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">weight</span><span class="pi">:</span> <span class="m">0</span>
    <span class="na">uuid</span><span class="pi">:</span> <span class="s">1cfec298-8620-4749-b100-ccb6c4500779</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>也可以动态的去修改 *.setting.yml` 中的配置。</p>

<p>如在 <code class="language-plaintext highlighter-rouge">hello_world/hello_world.install</code> 中定义如下代码:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td>
<td class="rouge-code"><pre><span class="cd">/**
 * Implements hook_install().
 */</span>
<span class="k">function</span> <span class="n">hello_world_install</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Set default values for config which require dynamic values.</span>
  <span class="err">\</span><span class="nc">Drupal</span><span class="o">::</span><span class="nf">configFactory</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getEditable</span><span class="p">(</span><span class="s1">'hello_world.settings'</span><span class="p">)</span>
   <span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'default_form_address'</span><span class="p">,</span> <span class="err">\</span><span class="nc">Drupal</span><span class="o">::</span><span class="nf">config</span><span class="p">(</span><span class="s1">'system.site'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'mail'</span><span class="p">))</span>
   <span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<h3 id="可选配置">可选配置</h3>

<p>可选配置一般保存在 <code class="language-plaintext highlighter-rouge">config/optional</code> 中, 它只在依赖存在的情况下才会生效。</p>

<p>如 A 模块有一个可选配置依赖于 B 模块, A 模块先安装, 当安装 B 模块时, 会自动扫描 A 模块的 <code class="language-plaintext highlighter-rouge">config/optional</code>, 找到依赖并安装。</p>

<p>如果 B 模块没有安装, 那么 A 模块的可选配置将不会启用</p>

<p>核心模块中有很多的示例, 比如 <code class="language-plaintext highlighter-rouge">block_content</code> 模块中, <code class="language-plaintext highlighter-rouge">views.view.block_content.yml</code> 中有如下配置, 只列举一部分:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td>
<td class="rouge-code"><pre><span class="na">langcode</span><span class="pi">:</span> <span class="s">en</span>
<span class="na">status</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">dependencies</span><span class="pi">:</span>
  <span class="na">module</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">block_content</span>
    <span class="pi">-</span> <span class="s">user</span>
<span class="na">id</span><span class="pi">:</span> <span class="s">block_content</span>
<span class="na">label</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Custom</span><span class="nv"> </span><span class="s">block</span><span class="nv"> </span><span class="s">library'</span>
<span class="na">module</span><span class="pi">:</span> <span class="s">views</span>
<span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Find</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">manage</span><span class="nv"> </span><span class="s">custom</span><span class="nv"> </span><span class="s">blocks.'</span>
<span class="na">tag</span><span class="pi">:</span> <span class="s">default</span>
<span class="na">base_table</span><span class="pi">:</span> <span class="s">block_content_field_data</span>
<span class="na">base_field</span><span class="pi">:</span> <span class="s">id</span>
<span class="na">core</span><span class="pi">:</span> <span class="s">8.x</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<h3 id="更新配置">更新配置</h3>

<p>可以使用 <code class="language-plaintext highlighter-rouge">drush config-import</code> 这个命令把配置更新到数据库中。</p>

<p>首先在 <code class="language-plaintext highlighter-rouge">setting.php</code> 中找到如下配置, 如:</p>

<p>(<code class="language-plaintext highlighter-rouge">setting.php</code> 是 Drupal8 的配置文件, 一般是在 <code class="language-plaintext highlighter-rouge">sites/default</code> 下)</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="nv">$config_directories</span><span class="p">[</span><span class="s1">'sync'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'sites/default/files/config_bBkGn-0ZX0fe_fnnlVS3dmxhz7_z6guu819vcYXEpc4NtTBYgr8vB2Tqwp0t8-Oz9j71_los1g/sync'</span><span class="p">;</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>接下来把 <code class="language-plaintext highlighter-rouge">hello_world.setting.yml</code> 放到这个目录下, 然后执行 <code class="language-plaintext highlighter-rouge">drush cim &amp;&amp; drush cr</code> 命令。</p>

<p>访问数据库 config, 查询配置是否更新成功。</p>

<h2 id="覆写系统配置">覆写系统配置</h2>

<h3 id="覆写-global">覆写 Global</h3>

<p>Drupal8 可以使用 <code class="language-plaintext highlighter-rouge">$config</code> 这个全局变量来访问配置。</p>

<p>通常通过 <code class="language-plaintext highlighter-rouge">Drupal\Core\Config\COnfigFactory::get()</code> 这个 API 来获取配置的值。</p>

<p>比如, 我们获取网站维护的 <code class="language-plaintext highlighter-rouge">message</code>:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="nv">$message</span> <span class="o">=</span> <span class="err">\</span><span class="nc">Drupal</span><span class="o">::</span><span class="nf">config</span><span class="p">(</span><span class="s1">'system.maintenance'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'message'</span><span class="p">);</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>可以在 <code class="language-plaintext highlighter-rouge">setting.php</code> 中直接来覆写这个变量:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="nv">$config</span><span class="p">[</span><span class="s1">'system.maintenance'</span><span class="p">][</span><span class="s1">'message'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'Sorry, our site is down now.'</span><span class="p">;</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>在 <code class="language-plaintext highlighter-rouge">Configuration-&gt;Performance-&gt;Aggregate CSS files</code> 这里, 安装完以后 Drupal8 是默认打开的, 关闭代码如下:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="nv">$config</span><span class="p">[</span><span class="s1">'system.performance'</span><span class="p">][</span><span class="s1">'css'</span><span class="p">][</span><span class="s1">'preprocess'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>然后通过 drush 命令查看是否覆写成功。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td>
<td class="rouge-code"><pre><span class="o">&gt;</span> drush config-list
<span class="o">&gt;</span> drush config-get system.performance
</pre></td>
</tr></tbody></table></code></pre></div></div>

<h3 id="获取原值">获取原值</h3>

<p>配置被覆写以后, 怎么获取原值呢？以下是示例代码:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td>
<td class="rouge-code"><pre><span class="c1">// Get the site name, with overrides.</span>
<span class="nv">$site_name</span> <span class="o">=</span> <span class="err">\</span><span class="nc">Drupal</span><span class="o">::</span><span class="nf">config</span><span class="p">(</span><span class="s1">'system.site'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'name'</span><span class="p">);</span>

<span class="c1">// Get the site name without overrides.</span>
<span class="nv">$site_name</span> <span class="o">=</span> <span class="err">\</span><span class="nc">Drupal</span><span class="o">::</span><span class="nf">config</span><span class="p">(</span><span class="s1">'system.site'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">getOriginal</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="kc">FALSE</span><span class="p">);</span>

<span class="c1">// Note that mutable config is always override free.</span>
<span class="nv">$site_name</span> <span class="o">=</span> <span class="err">\</span><span class="nc">Drupal</span><span class="o">::</span><span class="nf">configFactory</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getEditable</span><span class="p">(</span><span class="s1">'system.site'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'name'</span><span class="p">);</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<h3 id="覆写语言配置">覆写语言配置</h3>

<p>多语言站点中, 要给用户发送邮件, 这时候邮件语言取决于用户的语言配置。代码如下:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td>
<td class="rouge-code"><pre><span class="c1">// Load the language_manager service</span>
<span class="nv">$language_manager</span> <span class="o">=</span> <span class="err">\</span><span class="nc">Drupal</span><span class="o">::</span><span class="nf">service</span><span class="p">(</span><span class="s1">'language_manager'</span><span class="p">);</span>

<span class="c1">// Get the target language object</span>
<span class="nv">$langcode</span> <span class="o">=</span> <span class="nv">$account</span><span class="o">-&gt;</span><span class="nf">getPerferredLangcode</span><span class="p">();</span>
<span class="nv">$language</span> <span class="o">=</span> <span class="nv">$language_manager</span><span class="o">-&gt;</span><span class="nf">getLanguage</span><span class="p">(</span><span class="nv">$langcode</span><span class="p">);</span>

<span class="c1">// Remember original language before this operation.</span>
<span class="nv">$original_language</span> <span class="o">=</span> <span class="nv">$language_manager</span><span class="o">-&gt;</span><span class="nf">getConfigOverrideLanguage</span><span class="p">();</span>
<span class="c1">// Set the translation target language on the configuration factory.</span>
<span class="nv">$language_manager</span><span class="o">-&gt;</span><span class="nf">setConfigOverrideLanguage</span><span class="p">(</span><span class="nv">$language</span><span class="p">);</span>

<span class="nv">$mail_config</span> <span class="o">=</span> <span class="err">\</span><span class="nc">Drupal</span><span class="o">::</span><span class="nf">config</span><span class="p">(</span><span class="s1">'user.mail'</span><span class="p">);</span>

<span class="c1">// Now send email based on $mail_config which is in the proper language.</span>

<span class="c1">// Set the configuration language back.</span>
<span class="nv">$language_manager</span><span class="o">-&gt;</span><span class="nf">setCOnfigOverrideLanguage</span><span class="p">(</span><span class="nv">$original_language</span><span class="p">);</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>这段代码主要是把 <code class="language-plaintext highlighter-rouge">user.mail</code> 这个配置更改为 <code class="language-plaintext highlighter-rouge">language.config.$langcode.user.mail</code>, 发送邮件的时候就会自动找用户设置的语言, 从而找到跟用户语言相符合的邮件模版。</p>

<h3 id="模块中覆写配置">模块中覆写配置</h3>

<p><code class="language-plaintext highlighter-rouge">ConfigFactory</code> 会扫描所有模块, 并从中找到实现了 <code class="language-plaintext highlighter-rouge">config.factory.override</code> 的 <code class="language-plaintext highlighter-rouge">service</code>。</p>

<p>如在 <code class="language-plaintext highlighter-rouge">hello_world.services.yml</code> 中定义如下:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td>
<td class="rouge-code"><pre><span class="na">services</span><span class="pi">:</span>
  <span class="na">hello_world.config_example.overrider</span><span class="pi">:</span>
    <span class="na">class</span><span class="pi">:</span> <span class="s">\Drupal\hello_world\ConfigExampleOverrides</span>
    <span class="na">tags</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="pi">{</span><span class="nv">name</span><span class="pi">:</span> <span class="nv">config.factory.override</span><span class="pi">,</span> <span class="nv">priority</span><span class="pi">:</span> <span class="nv">5</span><span class="pi">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>在 <code class="language-plaintext highlighter-rouge">src/ConfigExampleOverrides.php</code> 编写如下代码:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre></td>
<td class="rouge-code"><pre><span class="cp">&lt;?php</span>
<span class="kn">namespace</span> <span class="nn">Drupal\hello_world</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Drupal\Core\Cache\CacheableMetadata</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Drupal\Core\Config\COnfigFactoryOverrideInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Drupal\Core\Config\StorageInterface</span><span class="p">;</span>

<span class="cd">/**
 * Example configuration override.
 */</span>
<span class="kd">class</span> <span class="nc">ConfigExampleOverrides</span> <span class="kd">implements</span> <span class="nc">ConfigFactoryOverrideInterface</span> <span class="p">{</span>

  <span class="k">public</span> <span class="k">function</span> <span class="n">loadOverrides</span><span class="p">(</span><span class="nv">$names</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$overrides</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="s1">'system.site'</span><span class="p">,</span> <span class="nv">$names</span><span class="p">))</span> <span class="p">{</span>
      <span class="nv">$overrides</span><span class="p">[</span><span class="s1">'system.site'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Overridden site name!'</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$overrides</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cd">/**
   * {@inheritdoc}
   */</span>
  <span class="k">public</span> <span class="k">function</span> <span class="n">getCacheSuffix</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">'ConfigExampleOverrider'</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cd">/**
   * {@inheritdoc}
   */</span>
  <span class="k">public</span> <span class="k">function</span> <span class="n">getCacheableMetadata</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">CacheableMetadata</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="cd">/**
   * {@inheritdoc}
   */</span>
  <span class="k">public</span> <span class="k">function</span> <span class="n">createConfigObject</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$collection</span> <span class="o">=</span> <span class="nc">StorageInterface</span><span class="o">::</span><span class="no">DEFAULT_COLLECTION</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">NULL</span><span class="p">;</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>上面代码实现了 <code class="language-plaintext highlighter-rouge">ConfigFactoryOverrideInterface</code> 的四个方法:</p>

<ol>
  <li>
<code class="language-plaintext highlighter-rouge">loadOverrides</code>: 返回配置覆写数组</li>
  <li>
<code class="language-plaintext highlighter-rouge">getCacheSuffix</code>: 返回 cache 的前缀名称</li>
  <li>
<code class="language-plaintext highlighter-rouge">getCacheableMetadata</code>: 返回被覆写后的 cache 数据</li>
  <li>
<code class="language-plaintext highlighter-rouge">createConfigObject</code>: 安装或同步的时候创建一个 config 对象, 这里是覆写, 所以返回 NULL</li>
</ol>

<h2 id="配置-shema--metadata">配置 shema / metadata</h2>

<ol>
  <li>
<code class="language-plaintext highlighter-rouge">schema</code> 描述配置文件的结构</li>
  <li>
<code class="language-plaintext highlighter-rouge">metadata</code> 配置的元数据</li>
</ol>

<h3 id="一个简单的示例">一个简单的示例</h3>

<p>有如下代码:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td>
<td class="rouge-code"><pre><span class="nv">$config</span> <span class="o">=</span> <span class="err">\</span><span class="nc">Drupal</span><span class="o">::</span><span class="nf">config</span><span class="p">(</span><span class="s1">'system.maintenance'</span><span class="p">);</span>
<span class="nv">$message</span> <span class="o">=</span> <span class="nv">$config</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'message'</span><span class="p">);</span>
<span class="nv">$langcode</span> <span class="o">=</span> <span class="nv">$config</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'langcode'</span><span class="p">);</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>config 数据结构体的默认值是保存在配置文件 <code class="language-plaintext highlighter-rouge">core/modules/system/config/install/system.maintenance.yml</code></p>

<p>代码如下:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td>
<td class="rouge-code"><pre><span class="na">message</span><span class="pi">:</span> <span class="s1">'</span><span class="s">@site</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">currently</span><span class="nv"> </span><span class="s">under</span><span class="nv"> </span><span class="s">maintenance.</span><span class="nv"> </span><span class="s">We</span><span class="nv"> </span><span class="s">should</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">back</span><span class="nv"> </span><span class="s">shortly.</span><span class="nv"> </span><span class="s">Thank</span><span class="nv"> </span><span class="s">you</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">your</span><span class="nv"> </span><span class="s">patience.'</span><span class="s1">'</span>
<span class="s">langcode:</span><span class="nv"> </span><span class="s">en</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>在 <code class="language-plaintext highlighter-rouge">core/modules/system/config/schema/system.schema.yml</code> 文件中定义数据结构题。</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td>
<td class="rouge-code"><pre><span class="na">system.maintenance</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">config_object</span>
  <span class="na">label</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Maintenance</span><span class="nv"> </span><span class="s">mode'</span>
  <span class="na">mapping</span><span class="pi">:</span>
    <span class="na">message</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">text</span>
      <span class="na">label</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Message</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">display</span><span class="nv"> </span><span class="s">when</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">maintenance</span><span class="nv"> </span><span class="s">mode'</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>schema 定义了一个 mapping 数据结构体, 可以认为是一个数组。</p>

<p>注意: 一个 <code class="language-plaintext highlighter-rouge">schema.yml</code> 文件可以定义多个数据结构体, 每一个数据结构体的机器名必须与 <code class="language-plaintext highlighter-rouge">setting.yml</code> 文件名一致</p>

<h3 id="schema-属性">schema 属性</h3>

<h4 id="type">Type</h4>

<p>有基本类型和派生类型</p>

<ol>
  <li>
    <p>基本类型 (core.data_types.schema.yml)</p>

    <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td>
<td class="rouge-code"><pre> <span class="c1"># Undefined type used by the system to assign to elements at any level where</span>
 <span class="c1"># configuration schema is not defined. Using explicitly has the same effect as</span>
 <span class="c1"># not defining schema, so there is no point in doing that.</span>
 <span class="na">underfined</span><span class="pi">:</span>
   <span class="na">label</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Underfined'</span>
   <span class="na">class</span><span class="pi">:</span> <span class="s1">'</span><span class="s">\Drupal\Core\Config\Schema\Underfined'</span>

 <span class="c1"># Explicit type to use when no data typing is possible. Instead of using this</span>
 <span class="c1"># type, we strongly suggest you use configuration structures that can be</span>
 <span class="c1"># described with other structural elements of schema, and describe your schema</span>
 <span class="c1"># with those elements.</span>
 <span class="na">ignore</span><span class="pi">:</span>
   <span class="na">label</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Ignore'</span>
   <span class="na">class</span><span class="pi">:</span> <span class="s1">'</span><span class="s">\Drupal\Core\Config\Schema\Ignore'</span>

 <span class="c1"># Basic scalar data types from typed data.</span>
 <span class="na">boolean</span><span class="pi">:</span>
   <span class="na">label</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Boolean'</span>
   <span class="na">class</span><span class="pi">:</span> <span class="s1">'</span><span class="s">\Drupal\Core\TypedData\Plugin\DataType\BooleanData'</span>
 <span class="na">email</span><span class="pi">:</span>
   <span class="na">label</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Email'</span>
   <span class="na">class</span><span class="pi">:</span> <span class="s1">'</span><span class="s">\Drupal\Core\TypedData\Plugin\DataType\Email'</span>
 <span class="na">integer</span><span class="pi">:</span>
   <span class="na">label</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Integer'</span>
   <span class="na">class</span><span class="pi">:</span> <span class="s1">'</span><span class="s">\Drupal\Core\TypedData\Plugin\DataType\IntegerData'</span>
 <span class="na">float</span><span class="pi">:</span>
   <span class="na">label</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Float'</span>
   <span class="na">class</span><span class="pi">:</span> <span class="s1">'</span><span class="s">\Drupal\Core\TypedData\Plugin\DataType\FloatData'</span>
 <span class="na">string</span><span class="pi">:</span>
   <span class="na">label</span><span class="pi">:</span> <span class="s1">'</span><span class="s">String'</span>
   <span class="na">class</span><span class="pi">:</span> <span class="s1">'</span><span class="s">\Drupal\Core\TypedData\Plugin\DataType\StringData'</span>
 <span class="na">uri</span><span class="pi">:</span>
   <span class="na">label</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Uri'</span>
   <span class="na">class</span><span class="pi">:</span> <span class="s1">'</span><span class="s">\Drupal\Core\TypedData\Plugin\DataType\Uri'</span>
</pre></td>
</tr></tbody></table></code></pre></div>    </div>

    <ol>
      <li>
<code class="language-plaintext highlighter-rouge">label</code>: 短标签</li>
      <li>
<code class="language-plaintext highlighter-rouge">translatable</code>: 是否可被翻译</li>
      <li>
<code class="language-plaintext highlighter-rouge">nullable</code>: 是否允许空值</li>
      <li>
<code class="language-plaintext highlighter-rouge">class</code>: 实现的类名</li>
    </ol>

    <p>另外还有:</p>

    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">config_object</code>: 默认配置结构</li>
      <li>
<code class="language-plaintext highlighter-rouge">config_entity</code>: 实体配置结构</li>
    </ul>
  </li>
  <li>
    <p>派生类型</p>

    <p><code class="language-plaintext highlighter-rouge">mapping</code>: 关联数组 (associative array), key/value数据结构, 只支持 string 类型</p>

    <p><code class="language-plaintext highlighter-rouge">sequence</code>: 索引数组 (indexed array)</p>
  </li>
</ol>

<h3 id="动态类型-parent">动态类型 <code class="language-plaintext highlighter-rouge">[%parent]</code>
</h3>

<p>下面的示例我们定义了两个动态类型 <code class="language-plaintext highlighter-rouge">warning</code> 和 <code class="language-plaintext highlighter-rouge">multiple</code>, <code class="language-plaintext highlighter-rouge">multiple</code> 是一个列表, <code class="language-plaintext highlighter-rouge">warning</code> 是一个当行文本。</p>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">config/install/hello_world.message.single.yml</code></p>

    <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td>
<td class="rouge-code"><pre> <span class="na">type</span><span class="pi">:</span> <span class="s">warning</span>
 <span class="na">message</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Hello!'</span>
 <span class="na">langcode</span><span class="pi">:</span> <span class="s">en</span>
</pre></td>
</tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">config/install/hello_world.message.multiple.yml</code></p>

    <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td>
<td class="rouge-code"><pre> <span class="na">type</span><span class="pi">:</span> <span class="s">multiple</span>
 <span class="na">message</span><span class="pi">:</span>
   <span class="pi">-</span> <span class="s1">'</span><span class="s">Hello!'</span>
   <span class="pi">-</span> <span class="s1">'</span><span class="s">Hi!'</span>
 <span class="na">langcode</span><span class="pi">:</span> <span class="s">en</span>
</pre></td>
</tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">config/schema/hello_world.schema.yml</code></p>

    <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td>
<td class="rouge-code"><pre> <span class="na">hello_world.message.*</span><span class="pi">:</span>
   <span class="na">type</span><span class="pi">:</span> <span class="s">config_object</span>
   <span class="na">mapping</span><span class="pi">:</span>
     <span class="na">type</span><span class="pi">:</span>
       <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
       <span class="na">label</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Message</span><span class="nv"> </span><span class="s">type'</span>
     <span class="na">message</span><span class="pi">:</span>
       <span class="na">type</span><span class="pi">:</span> <span class="s">hello_world_message.[%parent.type]</span>
     <span class="na">langcode</span><span class="pi">:</span>
       <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
       <span class="na">label</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Language</span><span class="nv"> </span><span class="s">code'</span>

 <span class="na">hello_world_message.warning</span><span class="pi">:</span>
   <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>

 <span class="na">hello_world.message.multiple</span><span class="pi">:</span>
   <span class="na">type</span><span class="pi">:</span> <span class="s">sequence</span>
   <span class="na">label</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Messages'</span>
   <span class="na">sequence</span><span class="pi">:</span>
     <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
     <span class="na">label</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Message'</span>
</pre></td>
</tr></tbody></table></code></pre></div>    </div>

    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">*</code> 表示通配符, 这里指 single 或 multiple</li>
      <li>
<code class="language-plaintext highlighter-rouge">$parent.type</code> 指我们在下面定义的数据类型, 注意: 这里定义的机器名要和父节点的机器名不能重名</li>
    </ul>
  </li>
</ol>

<h3 id="动态类型-type">动态类型 <code class="language-plaintext highlighter-rouge">[type]</code>
</h3>

<p>如果想要在已有的数据下面定义你自己不同的数据类型, 那么 <code class="language-plaintext highlighter-rouge">[type]</code> 将会变得非常有用。</p>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">config/install/hello_world.message.single.yml</code></p>

    <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td>
<td class="rouge-code"><pre> <span class="na">message</span><span class="pi">:</span>
   <span class="na">type</span><span class="pi">:</span> <span class="s">warning</span>
   <span class="na">value</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Hello!'</span>
 <span class="na">langcode</span><span class="pi">:</span> <span class="s">en</span>
</pre></td>
</tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">config/install/hello_world.message.multiple.yml</code></p>

    <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td>
<td class="rouge-code"><pre> <span class="na">message</span><span class="pi">:</span>
   <span class="na">type</span><span class="pi">:</span> <span class="s">multiple</span>
   <span class="na">value</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="s1">'</span><span class="s">Hello!'</span>
     <span class="pi">-</span> <span class="s1">'</span><span class="s">Hi</span><span class="nv"> </span><span class="s">!'</span>
 <span class="na">langcode</span><span class="pi">:</span> <span class="s">en</span>
</pre></td>
</tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">config/schema/hello_world.schema.yml</code></p>

    <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td>
<td class="rouge-code"><pre> <span class="na">hello_world.message.*</span><span class="pi">:</span>
   <span class="na">type</span><span class="pi">:</span> <span class="s">config_object</span>
   <span class="na">mapping</span><span class="pi">:</span>
     <span class="na">message</span><span class="pi">:</span>
       <span class="na">type</span><span class="pi">:</span> <span class="s">hello_world_message.[type]</span>
     <span class="pi">[</span><span class="nv">...</span><span class="pi">]</span>

 <span class="na">hello_world_message.warning</span><span class="pi">:</span>
   <span class="na">type</span><span class="pi">:</span> <span class="s">mapping</span>
   <span class="pi">[</span><span class="nv">...</span><span class="pi">]</span>

 <span class="na">hello_world_message.multiple</span><span class="pi">:</span>
   <span class="na">type</span><span class="pi">:</span> <span class="s">mapping</span>
   <span class="pi">[</span><span class="nv">...</span><span class="pi">]</span>
</pre></td>
</tr></tbody></table></code></pre></div>    </div>

    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">[type]</code> 动态定义了 message 的类型, 并且要求 warning 和 multiple 的类型必须一致, 上面的示例代码都是 mapping 类型</li>
    </ul>
  </li>
</ol>

<h3 id="动态类型-key">动态类型 <code class="language-plaintext highlighter-rouge">[%key]</code>
</h3>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">config/install/hello_world.messages.yml</code></p>

    <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td>
<td class="rouge-code"><pre> <span class="na">message</span><span class="pi">:</span>
   <span class="s1">'</span><span class="s">single:1'</span><span class="err">:</span> <span class="s1">'</span><span class="s">Hello!'</span>
   <span class="s1">'</span><span class="s">single:2'</span><span class="err">:</span> <span class="s1">'</span><span class="s">Hi</span><span class="nv"> </span><span class="s">!'</span>
   <span class="s1">'</span><span class="s">multiple:1'</span><span class="err">:</span>
     <span class="pi">-</span> <span class="s1">'</span><span class="s">Good</span><span class="nv"> </span><span class="s">morning!'</span>
     <span class="pi">-</span> <span class="s1">'</span><span class="s">Good</span><span class="nv"> </span><span class="s">night!'</span>
 <span class="na">langcode</span><span class="pi">:</span> <span class="s">en</span>
</pre></td>
</tr></tbody></table></code></pre></div>    </div>

    <p>这是一个任意消息元素的列表。</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">config/schema/hello_world.schema.yml</code></p>

    <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td>
<td class="rouge-code"><pre> <span class="na">hello_world_message.messages</span><span class="pi">:</span>
     <span class="na">type</span><span class="pi">:</span> <span class="s">config_object</span>
     <span class="na">mapping</span><span class="pi">:</span>
       <span class="na">message</span><span class="pi">:</span>
         <span class="na">type</span><span class="pi">:</span> <span class="s">sequence</span>
         <span class="na">label</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Messages'</span>
         <span class="na">sequence</span><span class="pi">:</span>
           <span class="na">type</span><span class="pi">:</span> <span class="s">hello_world_message.[%key]</span>
       <span class="na">langcode</span><span class="pi">:</span>
         <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
         <span class="na">label</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Language</span><span class="nv"> </span><span class="s">code'</span>

     <span class="s">hello_world_message.single:*:</span>
       <span class="s">type</span><span class="err">:</span> <span class="s">string</span>
       <span class="s">label</span><span class="err">:</span> <span class="s1">'</span><span class="s">Message'</span>

     <span class="s">hello_world_message.multiple:*:</span>
       <span class="s">type</span><span class="err">:</span> <span class="s">sequence</span>
       <span class="s">label</span><span class="err">:</span> <span class="s1">'</span><span class="s">Messages'</span>
       <span class="na">sequence</span><span class="pi">:</span>
         <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
         <span class="na">label</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Message'</span>
</pre></td>
</tr></tbody></table></code></pre></div>    </div>

    <p>这里定义了一个序列数组 messages, 而序列数组的类型就是 hello_world_message 定义的动态类型。</p>
  </li>
</ol>

<h2 id="创建配置实体">创建配置实体</h2>

<h3 id="定义路由">定义路由</h3>

<p>在 <code class="language-plaintext highlighter-rouge">example/example.routing.yml</code> 中定义四个路由: <code class="language-plaintext highlighter-rouge">list / add / edit / delete</code>。</p>

<p>代码如下:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td>
<td class="rouge-code"><pre><span class="na">entity.example.collection</span><span class="pi">:</span>
  <span class="na">path</span><span class="pi">:</span> <span class="s1">'</span><span class="s">/admin/config/system/example'</span>
  <span class="na">defaults</span><span class="pi">:</span>
    <span class="na">_entity_list</span><span class="pi">:</span> <span class="s1">'</span><span class="s">example'</span>
    <span class="na">_title</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Example</span><span class="nv"> </span><span class="s">configuration'</span>
  <span class="na">requirements</span><span class="pi">:</span>
    <span class="na">_permission</span><span class="pi">:</span> <span class="s1">'</span><span class="s">administer</span><span class="nv"> </span><span class="s">site</span><span class="nv"> </span><span class="s">configuration'</span>

<span class="na">entity.example.add_form</span><span class="pi">:</span>
  <span class="na">path</span><span class="pi">:</span> <span class="s1">'</span><span class="s">/admin/config/system/example/add'</span>
  <span class="na">defaults</span><span class="pi">:</span>
    <span class="na">_entity_form</span><span class="pi">:</span> <span class="s1">'</span><span class="s">example.add'</span>
    <span class="na">_title</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Add</span><span class="nv"> </span><span class="s">example'</span>
  <span class="na">requirements</span><span class="pi">:</span>
    <span class="na">_permission</span><span class="pi">:</span> <span class="s1">'</span><span class="s">administer</span><span class="nv"> </span><span class="s">site</span><span class="nv"> </span><span class="s">configuration'</span>

<span class="na">entity.example.edit_form</span><span class="pi">:</span>
  <span class="na">path</span><span class="pi">:</span> <span class="s1">'</span><span class="s">/admin/config/system/example/{example}'</span>
  <span class="na">defaults</span><span class="pi">:</span>
    <span class="na">_entity_form</span><span class="pi">:</span> <span class="s1">'</span><span class="s">example.edit'</span>
    <span class="na">_title</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Edit</span><span class="nv"> </span><span class="s">example'</span>
  <span class="na">requirements</span><span class="pi">:</span>
    <span class="na">_permission</span><span class="pi">:</span> <span class="s1">'</span><span class="s">administer</span><span class="nv"> </span><span class="s">site</span><span class="nv"> </span><span class="s">configuration'</span>

<span class="na">entity.example.delete_form</span><span class="pi">:</span>
  <span class="na">path</span><span class="pi">:</span> <span class="s1">'</span><span class="s">/admin/config/system/example/{example}/delete'</span>
  <span class="na">defaults</span><span class="pi">:</span>
    <span class="na">_entity_form</span><span class="pi">:</span> <span class="s1">'</span><span class="s">example.delete'</span>
    <span class="na">_title</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Delete</span><span class="nv"> </span><span class="s">example'</span>
  <span class="na">requirements</span><span class="pi">:</span>
    <span class="na">_permission</span><span class="pi">:</span> <span class="s1">'</span><span class="s">administer</span><span class="nv"> </span><span class="s">site</span><span class="nv"> </span><span class="s">configuration'</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<h3 id="定义菜单">定义菜单</h3>

<p>在 <code class="language-plaintext highlighter-rouge">example/example.links.action.yml</code> 定义一个添加按钮。</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td>
<td class="rouge-code"><pre><span class="na">entity.example.add_form</span><span class="pi">:</span>
  <span class="na">route_name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">entity.example.add_form'</span>
  <span class="na">title</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Add</span><span class="nv"> </span><span class="s">example'</span>
  <span class="na">appears_on</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">entity.example.collection</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<h3 id="实体类型类">实体类型类</h3>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">example/src/ExampleInterface.php</code></p>

    <p>假设实体里面包含一些属性, 需要在接口实现 <code class="language-plaintext highlighter-rouge">set/get</code> 方法。如:</p>

    <div class="language-php highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td>
<td class="rouge-code"><pre> <span class="cp">&lt;?php</span>
 <span class="kn">namespace</span> <span class="nn">Drupal\example</span><span class="p">;</span>

 <span class="kn">use</span> <span class="nc">Drupal\Core\Config\Entity\Config\EntityInterface</span><span class="p">;</span>

 <span class="cd">/**
  * Provides an interface defining on Example entity.
 */</span>
 <span class="kd">interface</span> <span class="nc">ExampleInterface</span> <span class="kd">extends</span> <span class="nc">ConfigEntityInterface</span> <span class="p">{</span>
   <span class="c1">// Add get/set methods for your configuration properties here.</span>
 <span class="p">}</span>
</pre></td>
</tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">example/src/Entity/Example.php</code></p>

    <p>这个文件定义了配置类型的实现类。</p>

    <div class="language-php highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre></td>
<td class="rouge-code"><pre> <span class="cp">&lt;?php</span>
 <span class="kn">namespace</span> <span class="nn">Drupal\example\Entity</span><span class="p">;</span>

 <span class="kn">use</span> <span class="nc">Drupal\Core\Config\Entity\ConfigEntityBase</span><span class="p">;</span>
 <span class="kn">use</span> <span class="nc">Drupal\example\ExampleInterface</span><span class="p">;</span>

 <span class="cd">/**
  * Defines the Example entity
 *
 * @ConfigEntityType(
 *   id = "example",
 *   label = @Translation("Example"),
 *   handlers = {
 *     "list_builder" = "Drupal\example\Controller\ExampleListBuilder",
 *     "form" = {
 *       "add" = "Drupal\example\Form\ExampleForm",
 *       "edit" = "Drupal\example\Form\ExampleForm",
 *       "delete" = "Drupal\example\Form\ExampleDeleteForm",
 *     },
 *     config_prefix = "example",
 *     admin_permission = "administer site configuration",
 *     entity_keys = {
 *       "id" = "id",
 *       "label" = "label",
 *     },
 *     links = {
 *       "edit-form" = "/admin/config/system/example/{example}",
 *       "delete-form" = "/admin/config/system/example/{example}/delete",
 *     }
 *   }
 * )
 */</span>
 <span class="kd">class</span> <span class="nc">Example</span> <span class="kd">extends</span> <span class="nc">ConfigEntityBase</span> <span class="kd">implements</span> <span class="nc">ExampleInterface</span> <span class="p">{</span>

   <span class="cd">/**
    * The Example ID.
    *
    * @var string
    */</span>
   <span class="k">public</span> <span class="nv">$id</span><span class="p">;</span>

   <span class="cd">/**
    * The Example label.
    *
    * @var string
    */</span>
   <span class="k">public</span> <span class="nv">$label</span><span class="p">;</span>

   <span class="c1">// Your specific configuration property get/set methods go here,</span>
   <span class="c1">// implementing the interface.</span>

 <span class="p">}</span>
</pre></td>
</tr></tbody></table></code></pre></div>    </div>
  </li>
</ol>

<h3 id="配置-schema">配置 schema</h3>

<p>文件: <code class="language-plaintext highlighter-rouge">example/config/schema/example.schema.yml</code></p>

<p>在 <code class="language-plaintext highlighter-rouge">\Drupal\example\Entity\Example</code> 中定义的属性添加到这里。</p>

<p>注意: <code class="language-plaintext highlighter-rouge">ConfigEntityType</code> 注解里的 <code class="language-plaintext highlighter-rouge">config_prefix</code> 字段必须跟 <code class="language-plaintext highlighter-rouge">schema</code> 的 <code class="language-plaintext highlighter-rouge">prefix</code> 一致。</p>

<p>比如你定义的 <code class="language-plaintext highlighter-rouge">config_prefix</code> 是这样的: <code class="language-plaintext highlighter-rouge">config_prefix = "variable_name"</code></p>

<p>那么 <code class="language-plaintext highlighter-rouge">schema</code> 的格式必须是: <code class="language-plaintext highlighter-rouge">example.variable_name.*</code></p>

<p>这里我们定义的 <code class="language-plaintext highlighter-rouge">config_prefix</code> 是 <code class="language-plaintext highlighter-rouge">example</code>, 因此</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td>
<td class="rouge-code"><pre><span class="na">example.example.*</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">config_entity</span>
  <span class="na">label</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Example</span><span class="nv"> </span><span class="s">config'</span>
  <span class="na">mapping</span><span class="pi">:</span>
    <span class="na">id</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
      <span class="na">label</span><span class="pi">:</span> <span class="s1">'</span><span class="s">ID'</span>
    <span class="na">label</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">label</span>
      <span class="na">label</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Label'</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<h3 id="实体-controller">实体 controller</h3>

<ol>
  <li>
    <p>文件: <code class="language-plaintext highlighter-rouge">example/src/Form/ExampleForm.php</code></p>

    <div class="language-php highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
</pre></td>
<td class="rouge-code"><pre> <span class="cp">&lt;?php</span>
 <span class="kn">namespace</span> <span class="nn">Drupal\example\Form</span><span class="p">;</span>

 <span class="kn">use</span> <span class="nc">Drupal\Core\Entity\EntityForm</span><span class="p">;</span>
 <span class="kn">use</span> <span class="nc">Drupal\Core\Entity\Query\QueryFactory</span><span class="p">;</span>
 <span class="kn">use</span> <span class="nc">Drupal\Core\Form\FormStateInterface</span><span class="p">;</span>
 <span class="kn">use</span> <span class="nc">Symfony\Component\DependencyInjection\ContainerInterface</span><span class="p">;</span>

 <span class="cd">/**
  * Form handler for the Example add and edit forms.
 */</span>
 <span class="kd">class</span> <span class="nc">ExampleForm</span> <span class="kd">extends</span> <span class="nc">EntityForm</span> <span class="p">{</span>

   <span class="cd">/**
    * Constructs on ExampleForm object.
    *
    * @param \Drupal\Core\Entity\Query\QueryFactory $entity_query
    *   The entity query.
    */</span>
   <span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">(</span><span class="kt">QueryFactory</span> <span class="nv">$entity_query</span><span class="p">)</span> <span class="p">{</span>
     <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">entityQuery</span> <span class="o">=</span> <span class="nv">$entity_query</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="cd">/**
    * {@inheritdoc}
    */</span>
   <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="n">create</span><span class="p">(</span><span class="kt">ContainerInterface</span> <span class="nv">$container</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">return</span> <span class="k">new</span> <span class="nc">static</span><span class="p">(</span>
       <span class="nv">$container</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'entity.query'</span><span class="p">)</span>
     <span class="p">);</span>
   <span class="p">}</span>

   <span class="cd">/**
    * {@inheritdoc}
    */</span>
   <span class="k">public</span> <span class="k">function</span> <span class="n">form</span><span class="p">(</span><span class="kt">array</span> <span class="nv">$form</span><span class="p">,</span> <span class="kt">FormStateInterface</span> <span class="nv">$form_state</span><span class="p">)</span> <span class="p">{</span>
     <span class="nv">$form</span> <span class="o">=</span> <span class="k">parent</span><span class="o">::</span><span class="nf">form</span><span class="p">(</span><span class="nv">$form</span><span class="p">,</span> <span class="nv">$form_state</span><span class="p">);</span>

     <span class="nv">$example</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">entity</span><span class="p">;</span>

     <span class="nv">$form</span><span class="p">[</span><span class="s1">'label'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
       <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'textfield'</span><span class="p">,</span>
       <span class="s1">'#title'</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">t</span><span class="p">(</span><span class="s1">'Label'</span><span class="p">),</span>
       <span class="s1">'#maxlength'</span> <span class="o">=&gt;</span> <span class="mi">255</span><span class="p">,</span>
       <span class="s1">'#default_value'</span> <span class="o">=&gt;</span> <span class="nv">$example</span><span class="o">-&gt;</span><span class="nf">label</span><span class="p">(),</span>
       <span class="s1">'#description'</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">t</span><span class="p">(</span><span class="s1">'Label for the Example.'</span><span class="p">),</span>
       <span class="s1">'#required'</span> <span class="o">=&gt;</span> <span class="kc">TRUE</span><span class="p">,</span>
     <span class="p">];</span>

     <span class="nv">$form</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
       <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'machine_name'</span><span class="p">,</span>
       <span class="s1">'#default_value'</span> <span class="o">=&gt;</span> <span class="nv">$example</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">(),</span>
       <span class="s1">'#machine_name'</span> <span class="o">=&gt;</span> <span class="p">[</span>
           <span class="s1">'exists'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="nv">$this</span><span class="p">,</span> <span class="s1">'exist'</span><span class="p">],</span>
       <span class="p">],</span>
       <span class="s1">'#disabled'</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="nv">$example</span><span class="o">-&gt;</span><span class="nf">isNew</span><span class="p">(),</span>
     <span class="p">];</span>

     <span class="c1">// You will need additional form elements for your custom properties.</span>
     <span class="k">return</span> <span class="nv">$form</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="cd">/**
    * {@inheritdoc}
    */</span>
   <span class="k">public</span> <span class="k">function</span> <span class="n">save</span><span class="p">(</span><span class="kt">array</span> <span class="nv">$form</span><span class="p">,</span> <span class="kt">FormStateInterface</span> <span class="nv">$form_state</span><span class="p">)</span> <span class="p">{</span>
     <span class="nv">$example</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">entity</span><span class="p">;</span>
     <span class="nv">$status</span> <span class="o">=</span> <span class="nv">$example</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>

     <span class="k">if</span> <span class="p">(</span><span class="nv">$status</span><span class="p">)</span> <span class="p">{</span>
       <span class="nf">drupal_set_message</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">t</span><span class="p">(</span><span class="s1">'Save the %label Example.'</span><span class="p">,</span> <span class="p">[</span>
         <span class="s1">'%label'</span> <span class="o">=&gt;</span> <span class="nv">$example</span><span class="o">-&gt;</span><span class="nf">label</span><span class="p">(),</span>
       <span class="p">]));</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
       <span class="nf">drupal_set_message</span><span class="p">(</span><span class="n">this</span><span class="o">-&gt;</span><span class="nf">t</span><span class="p">(</span><span class="s1">'The %label Example was not saved.'</span><span class="p">,</span> <span class="p">[</span>
         <span class="s1">'%label'</span> <span class="o">=&gt;</span> <span class="nv">$example</span><span class="o">-&gt;</span><span class="nf">label</span><span class="p">(),</span>
       <span class="p">]));</span>
     <span class="p">}</span>
     <span class="nv">$form_state</span><span class="o">-&gt;</span><span class="nf">setRedirect</span><span class="p">(</span><span class="s1">'entity.example.collection'</span><span class="p">);</span>
   <span class="p">}</span>

   <span class="cd">/**
    * Helper function check whether an Example configuration entity exists.
    */</span>
   <span class="k">public</span> <span class="k">function</span> <span class="n">exist</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
     <span class="nv">$entity</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">entityQuery</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'example'</span><span class="p">)</span>
       <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span>
       <span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>
     <span class="k">return</span> <span class="p">(</span><span class="n">bool</span><span class="p">)</span><span class="nv">$entity</span><span class="p">;</span>
   <span class="p">}</span>

 <span class="p">}</span>
</pre></td>
</tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>
    <p>文件: <code class="language-plaintext highlighter-rouge">example/src/Controller/ExampleListBuilder.php</code></p>

    <div class="language-php highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td>
<td class="rouge-code"><pre> <span class="cp">&lt;?php</span>
 <span class="kn">namespace</span> <span class="nn">Drupal\example\Controller</span><span class="p">;</span>

 <span class="kn">use</span> <span class="nc">Drupal\Core\Config\Entity\ConfigEntityListBuilder</span><span class="p">;</span>
 <span class="kn">use</span> <span class="nc">Drupal\Core\Entity\EntityInterface</span><span class="p">;</span>

 <span class="cd">/**
  * Provides a listing of Example.
 */</span>
 <span class="kd">class</span> <span class="nc">ExampleListBuilder</span> <span class="kd">extends</span> <span class="nc">ConfigEntityListBuilder</span> <span class="p">{</span>

   <span class="cd">/**
    * {@inheritdoc}
    */</span>
   <span class="k">public</span> <span class="k">function</span> <span class="n">buildHeader</span><span class="p">()</span> <span class="p">{</span>
     <span class="nv">$header</span><span class="p">[</span><span class="s1">'label'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">t</span><span class="p">(</span><span class="s1">'Example'</span><span class="p">);</span>
     <span class="nv">$header</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">t</span><span class="p">(</span><span class="s1">'Machine name'</span><span class="p">);</span>
     <span class="k">return</span> <span class="nv">$header</span> <span class="o">+</span> <span class="k">parent</span><span class="o">::</span><span class="nf">buildHeader</span><span class="p">();</span>
   <span class="p">}</span>

   <span class="cd">/**
    * {@inheritdoc}
    */</span>
   <span class="k">public</span> <span class="k">function</span> <span class="n">buildRow</span><span class="p">(</span><span class="kt">EntityInterface</span> <span class="nv">$entity</span><span class="p">)</span> <span class="p">{</span>
     <span class="nv">$row</span><span class="p">[</span><span class="s1">'label'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getLabel</span><span class="p">(</span><span class="nv">$entity</span><span class="p">);</span>
     <span class="nv">$row</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$entity</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">();</span>

     <span class="c1">// You probably want a few more properties here ...</span>

     <span class="k">return</span> <span class="nv">$row</span> <span class="o">+</span> <span class="k">parent</span><span class="o">::</span><span class="nf">buildRow</span><span class="p">(</span><span class="nv">$entity</span><span class="p">);</span>
   <span class="p">}</span>

 <span class="p">}</span>
</pre></td>
</tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>
    <p>文件: <code class="language-plaintext highlighter-rouge">example/src/Form/ExampleDeleteForm</code></p>

    <div class="language-php highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre></td>
<td class="rouge-code"><pre> <span class="kn">namespace</span> <span class="nn">Drupal\example\Form</span><span class="p">;</span>

 <span class="kn">use</span> <span class="nc">Drupal\Core\Entity\EntityConfirmFormBase</span><span class="p">;</span>
 <span class="kn">use</span> <span class="nc">Drupal\Core\Url</span><span class="p">;</span>
 <span class="kn">use</span> <span class="nc">Drupal\Core\Form\FormStateInterface</span><span class="p">;</span>

 <span class="cd">/**
  * Builds the form to delete an Example.
 */</span>
 <span class="kd">class</span> <span class="nc">ExampleDeleteForm</span> <span class="kd">extends</span> <span class="nc">EntityConfirmFormBase</span> <span class="p">{</span>

   <span class="cd">/**
    * {@inheritdoc}
    */</span>
   <span class="k">public</span> <span class="k">function</span> <span class="n">getQuestion</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">t</span><span class="p">(</span><span class="s1">'Are you sure you want to delete %name?'</span><span class="p">,</span> <span class="p">[</span>
       <span class="s1">'%name'</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">entity</span><span class="o">-&gt;</span><span class="nf">label</span><span class="p">(),</span>
     <span class="p">]);</span>
   <span class="p">}</span>

   <span class="cd">/**
    * {@inheritdoc}
    */</span>
   <span class="k">public</span> <span class="k">function</span> <span class="n">getCancelUrl</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">return</span> <span class="k">new</span> <span class="nc">Url</span><span class="p">(</span><span class="s1">'entity.example.collection'</span><span class="p">);</span>
   <span class="p">}</span>

   <span class="cd">/**
    * {@inheritdoc}
    */</span>
   <span class="k">public</span> <span class="k">function</span> <span class="n">getConfirmText</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">t</span><span class="p">(</span><span class="s1">'Delete'</span><span class="p">);</span>
   <span class="p">}</span>

   <span class="cd">/**
    * {@inheritdoc}
    */</span>
   <span class="k">public</span> <span class="k">function</span> <span class="n">submitForm</span><span class="p">(</span><span class="kt">array</span> <span class="o">&amp;</span><span class="nv">$form</span><span class="p">,</span> <span class="kt">FormStateInterface</span> <span class="nv">$form_state</span><span class="p">)</span> <span class="p">{</span>
     <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">entity</span><span class="o">-&gt;</span><span class="nb">delete</span><span class="p">();</span>
     <span class="nf">drupal_set_message</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">t</span><span class="p">(</span><span class="s1">'Category %label has been deleted.'</span><span class="p">,</span> <span class="p">[</span>
       <span class="s1">'%label'</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">entity</span><span class="o">-&gt;</span><span class="nf">label</span><span class="p">(),</span>
     <span class="p">]));</span>
     <span class="nv">$form_state</span><span class="o">-&gt;</span><span class="nf">setRedirectUrl</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getCancelUrl</span><span class="p">());</span>
   <span class="p">}</span>

 <span class="p">}</span>
</pre></td>
</tr></tbody></table></code></pre></div>    </div>
  </li>
</ol>

<h2 id="配置-api-示例">配置 API 示例</h2>

<h3 id="读取配置">读取配置</h3>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td>
<td class="rouge-code"><pre><span class="c1">// Immutable Config (Read Only)</span>
<span class="nv">$config</span> <span class="o">=</span> <span class="err">\</span><span class="nc">Drupal</span><span class="o">::</span><span class="nf">config</span><span class="p">(</span><span class="s1">'system.performance'</span><span class="p">);</span>
<span class="c1">// Mutable Config (Read / Write)</span>
<span class="nv">$config</span> <span class="o">=</span> <span class="err">\</span><span class="nc">Drupal</span><span class="o">::</span><span class="nf">service</span><span class="p">(</span><span class="s1">'config.factory'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">getEditable</span><span class="p">(</span><span class="s1">'system.performance'</span><span class="p">);</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>第一个只读, 第二个方法可读写。</p>

<p>配置读取一般使用 <code class="language-plaintext highlighter-rouge">get</code> 方法, 如:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td>
<td class="rouge-code"><pre><span class="nv">$config</span> <span class="o">=</span> <span class="err">\</span><span class="nc">Drupal</span><span class="o">::</span><span class="nf">config</span><span class="p">(</span><span class="s1">'system.maintenance'</span><span class="p">);</span>
<span class="nv">$message</span> <span class="o">=</span> <span class="nv">$config</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'message'</span><span class="p">);</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>也可以改成链式写法:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="nv">$message</span> <span class="o">=</span> <span class="err">\</span><span class="nc">Drupal</span><span class="o">::</span><span class="nf">config</span><span class="p">(</span><span class="s1">'system.maintenance'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'message'</span><span class="p">);</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>读取一个嵌套配置, 使用 <code class="language-plaintext highlighter-rouge">.</code> 号连接起来。如:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="nv">$enabled</span> <span class="o">=</span> <span class="err">\</span><span class="nc">Drupal</span><span class="o">::</span><span class="nf">config</span><span class="p">(</span><span class="s1">'system.performance'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'cache.page.enabled'</span><span class="p">);</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<h3 id="写入配置">写入配置</h3>

<p>通常使用 <code class="language-plaintext highlighter-rouge">getEditable</code> 这个方法从 <code class="language-plaintext highlighter-rouge">\Drupal\Core\Config\Config</code> 中获取。如:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="nc">Drupal</span><span class="o">::</span><span class="nf">service</span><span class="p">(</span><span class="s1">'config.factory'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">getEditable</span><span class="p">(</span><span class="s1">'system.performance'</span><span class="p">);</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<h4 id="覆写单个配置">覆写单个配置</h4>

<p>一般使用 <code class="language-plaintext highlighter-rouge">set</code> 和 <code class="language-plaintext highlighter-rouge">save</code> 方法来变更配置。如:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td>
<td class="rouge-code"><pre><span class="nv">$config</span> <span class="o">=</span> <span class="err">\</span><span class="nc">Drupal</span><span class="o">::</span><span class="nf">service</span><span class="p">(</span><span class="s1">'config.factory'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">getEditable</span><span class="p">(</span><span class="s1">'system.performance'</span><span class="p">);</span>

<span class="c1">// Set a scalar value.</span>
<span class="nv">$config</span><span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'cache.page.enabled'</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="c1">// Set an array of values.</span>
<span class="nv">$page_cache_data</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'enabled'</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s1">'max_age'</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">,</span>
<span class="p">];</span>
<span class="nv">$config</span><span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'cache.page'</span><span class="p">,</span> <span class="nv">$page_cache_data</span><span class="p">);</span>

<span class="c1">// Save your data to the file system.</span>
<span class="nv">$config</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>也可以写成链式:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td>
<td class="rouge-code"><pre><span class="nc">Drupal</span><span class="o">::</span><span class="nf">service</span><span class="p">(</span><span class="s1">'config.factory'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">getEditable</span><span class="p">(</span><span class="s1">'system.performance'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'cache.page.enabled'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<h4 id="覆写所有配置">覆写所有配置</h4>

<p>如果要覆盖所有的配置数据, 可以使用 <code class="language-plaintext highlighter-rouge">setData</code> 方法, 代码如下:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td>
<td class="rouge-code"><pre><span class="c1">// Set all values.</span>
<span class="err">\</span><span class="nc">Drupal</span><span class="o">::</span><span class="nf">service</span><span class="p">(</span><span class="s1">'config.factory'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">getEditable</span><span class="p">(</span><span class="s1">'system.performance'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">setData</span><span class="p">([</span>
      <span class="s1">'cache'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'page'</span> <span class="o">=&gt;</span> <span class="p">[</span>
          <span class="s1">'enabled'</span> <span class="o">=&gt;</span> <span class="s1">'0'</span><span class="p">,</span>
          <span class="s1">'max_age'</span> <span class="o">=&gt;</span> <span class="s1">'0'</span><span class="p">,</span>
        <span class="p">],</span>
      <span class="p">],</span>
      <span class="s1">'preprocess'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'css'</span> <span class="o">=&gt;</span> <span class="s1">'0'</span><span class="p">,</span>
        <span class="s1">'js'</span> <span class="o">=&gt;</span> <span class="s1">'0'</span><span class="p">,</span>
      <span class="p">],</span>
      <span class="s1">'response'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'gzip'</span> <span class="o">=&gt;</span> <span class="s1">'0'</span><span class="p">,</span>
      <span class="p">],</span>
  <span class="p">])</span>
  <span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>注意: <code class="language-plaintext highlighter-rouge">setData</code> 会完全改变配置的数据结构, 务必更改的时候对应好键值。</p>

<h3 id="删除配置">删除配置</h3>

<h4 id="删除一个单独的配置">删除一个单独的配置</h4>

<p>代码如下:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td>
<td class="rouge-code"><pre><span class="nv">$config</span> <span class="o">=</span> <span class="err">\</span><span class="nc">Drupal</span><span class="o">::</span><span class="nf">service</span><span class="p">(</span><span class="s1">'config.facotry'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">getEditable</span><span class="p">(</span><span class="s1">'system.performance'</span><span class="p">);</span>
<span class="nv">$config</span><span class="o">-&gt;</span><span class="nf">clear</span><span class="p">(</span><span class="s1">'cache.page.max_age'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>
<span class="nv">$page_cache_data</span> <span class="o">=</span> <span class="nv">$config</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'cache.page'</span><span class="p">);</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>这时候打印 <code class="language-plaintext highlighter-rouge">$page_cache_data</code>, 会发现 <code class="language-plaintext highlighter-rouge">max_age</code> 已经被删除了。</p>

<h4 id="删除所有配置">删除所有配置</h4>

<p>通常使用 <code class="language-plaintext highlighter-rouge">delete</code> 方法, 代码如下:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="nc">Drupal</span><span class="o">::</span><span class="nf">service</span><span class="p">(</span><span class="s1">'config.factory'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">getEditable</span><span class="p">(</span><span class="s1">'system.performance'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">delete</span><span class="p">();</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<h3 id="最佳实践">最佳实践</h3>

<p>如果要在一个配置里保存多个字段, 我们可能要写多个 <code class="language-plaintext highlighter-rouge">save</code>, 如下:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td>
<td class="rouge-code"><pre><span class="nc">Drupal</span><span class="o">::</span><span class="nf">service</span><span class="p">(</span><span class="s1">'config.factory'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">getEditable</span><span class="p">(</span><span class="s1">'foo.bar'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'foo'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>
<span class="err">\</span><span class="nc">Drupal</span><span class="o">::</span><span class="nf">service</span><span class="p">(</span><span class="s1">'config.factory'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">getEditable</span><span class="p">(</span><span class="s1">'foo.bar'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'bar'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>这种代码是不合理的, 应该写成:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td>
<td class="rouge-code"><pre><span class="nv">$config</span> <span class="o">=</span> <span class="err">\</span><span class="nc">Drupal</span><span class="o">::</span><span class="nf">service</span><span class="p">(</span><span class="s1">'config.factory'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">getEditable</span><span class="p">(</span><span class="s1">'foo.bar'</span><span class="p">);</span>
<span class="nv">$config</span>
  <span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'foo'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'bar'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<h2 id="如何更改配置">如何更改配置</h2>

<p>如何更改我们在 <code class="language-plaintext highlighter-rouge">{module.settings.yml}</code> 定义的配置呢？</p>

<p>通常我们通过 <code class="language-plaintext highlighter-rouge">form</code> 表单来实现。</p>

<ol>
  <li>
    <p>文件: <code class="language-plaintext highlighter-rouge">example/config/install/example.settings.yml</code></p>

    <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td>
<td class="rouge-code"><pre> <span class="na">things</span><span class="pi">:</span> <span class="s">thingssss</span>
 <span class="na">other_things</span><span class="pi">:</span> <span class="s">other_thingssss</span>
</pre></td>
</tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>
    <p>文件: <code class="language-plaintext highlighter-rouge">example/src/Form/exampleSettingsForm.php</code></p>

    <div class="language-php highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
</pre></td>
<td class="rouge-code"><pre> <span class="cp">&lt;?php</span>
 <span class="kn">namespace</span> <span class="nn">Drupal\example\Form</span><span class="p">;</span>

 <span class="kn">use</span> <span class="nc">Drupal\Core\Form\ConfigFormBase</span><span class="p">;</span>
 <span class="kn">use</span> <span class="nc">Drupal\Core\Form\FormStateInterface</span><span class="p">;</span>

 <span class="cd">/**
  * Configure example settings for this site.
 */</span>
 <span class="kd">class</span> <span class="nc">exampleSettingsForm</span> <span class="kd">extends</span> <span class="nc">ConfigFormBase</span> <span class="p">{</span>

   <span class="cd">/**
    * {@inheritdoc}
    */</span>
   <span class="k">public</span> <span class="k">function</span> <span class="n">getFormId</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">return</span> <span class="s1">'example_admin_settings'</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="cd">/**
    * {@inheritdoc}
    */</span>
   <span class="k">protected</span> <span class="k">function</span> <span class="n">getEditableConfigNames</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">return</span> <span class="p">[</span>
       <span class="s1">'example.settings'</span><span class="p">,</span>
     <span class="p">];</span>
   <span class="p">}</span>

   <span class="cd">/**
    * {@inheritdoc}
    */</span>
   <span class="k">public</span> <span class="k">function</span> <span class="n">buildForm</span><span class="p">(</span><span class="kt">array</span> <span class="nv">$form</span><span class="p">,</span> <span class="kt">FormStateInterface</span> <span class="nv">$form_state</span><span class="p">)</span> <span class="p">{</span>
     <span class="nv">$config</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">config</span><span class="p">(</span><span class="s1">'example.settings'</span><span class="p">);</span>

     <span class="nv">$form</span><span class="p">[</span><span class="s1">'example_thing'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
       <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'textfield'</span><span class="p">,</span>
       <span class="s1">'#title'</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">t</span><span class="p">(</span><span class="s1">'Things'</span><span class="p">);</span>
       <span class="s1">'#default_value'</span> <span class="o">=&gt;</span> <span class="nv">$config</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'things'</span><span class="p">);</span>
     <span class="p">];</span>

     <span class="nv">$form</span><span class="p">[</span><span class="s1">'other_things'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
       <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'textfield'</span><span class="p">,</span>
       <span class="s1">'#title'</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">t</span><span class="p">(</span><span class="s1">'Other things'</span><span class="p">),</span>
       <span class="s1">'#default_value'</span> <span class="o">=&gt;</span> <span class="nv">$config</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'other_things'</span><span class="p">),</span>
     <span class="p">];</span>

     <span class="k">return</span> <span class="k">parent</span><span class="o">::</span><span class="nf">buildForm</span><span class="p">(</span><span class="nv">$form</span><span class="p">,</span> <span class="nv">$form_state</span><span class="p">);</span>
   <span class="p">}</span>

   <span class="cd">/**
    * {@inheritdoc}
    */</span>
   <span class="k">public</span> <span class="k">function</span> <span class="n">submitForm</span><span class="p">(</span><span class="kt">array</span> <span class="o">&amp;</span><span class="nv">$form</span><span class="p">,</span> <span class="kt">FormStateInterface</span> <span class="nv">$form_state</span><span class="p">)</span> <span class="p">{</span>
     <span class="c1">// Retrieve the configuration</span>
     <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">config</span><span class="p">(</span><span class="s1">'example.settings'</span><span class="p">)</span>
       <span class="c1">// Set the submitted configuration setting</span>
       <span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'things'</span><span class="p">,</span> <span class="nv">$form_state</span><span class="o">-&gt;</span><span class="nf">getValue</span><span class="p">(</span><span class="s1">'example_thing'</span><span class="p">))</span>
       <span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'other_things'</span><span class="p">,</span> <span class="nv">$form_state</span><span class="o">-&gt;</span><span class="nf">getValue</span><span class="p">(</span><span class="s1">'other_things'</span><span class="p">))</span>
       <span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>

     <span class="k">parent</span><span class="o">::</span><span class="nf">submitForm</span><span class="p">(</span><span class="nv">$form</span><span class="p">,</span> <span class="nv">$form_state</span><span class="p">);</span>
   <span class="p">}</span>

 <span class="p">}</span>
</pre></td>
</tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>
    <p>文件: example/example.routing.yml</p>

    <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td>
<td class="rouge-code"><pre> <span class="na">example.settings</span><span class="pi">:</span>
   <span class="na">path</span><span class="pi">:</span> <span class="s1">'</span><span class="s">/admin/structure/example/settings'</span>
   <span class="na">defaults</span><span class="pi">:</span>
     <span class="na">_form</span><span class="pi">:</span> <span class="s1">'</span><span class="s">\Drupal\example\Form\exampleSettingsForm'</span>
     <span class="na">_title</span><span class="pi">:</span> <span class="s1">'</span><span class="s">example'</span>
   <span class="na">requirements</span><span class="pi">:</span>
     <span class="na">_permission</span><span class="pi">:</span> <span class="s1">'</span><span class="s">administer</span><span class="nv"> </span><span class="s">site</span><span class="nv"> </span><span class="s">configuration'</span>
</pre></td>
</tr></tbody></table></code></pre></div>    </div>
  </li>
</ol>

<p>以上代码已经很清晰的说明了如何通过 <code class="language-plaintext highlighter-rouge">form</code> 表单来更改默认的配置。</p>

<h2 id="实践">实践</h2>

<ol>
  <li>按照讲义进行练习</li>
  <li>设计一个配置, 可配置性别、类型（企业、个人、代理等）, 等至少列举5项, 需使用动态 schema</li>
  <li>以上配置都可以在 form 表单里更改</li>
  <li>更改一个系统配置</li>
</ol>

<p>以上, 自由发挥。</p>


                <!-- Copyright Notice -->
                
<hr>

<p>
  本文由
  <a href="/about/" target="_blank">
    Oscaner
  </a> 创作, 采用
  <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="external nofollow">
    知识共享署名4.0
  </a> 国际许可协议进行许可 <br>
  本站文章除注明转载/出处外, 均为本站原创或翻译, 转载前请务必署名
</p>


                

                <hr>
<hr style="visibility: hidden;">

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/skill/js/angularjs-excel.html" data-toggle="tooltip" data-placement="top" title="AngularJS 实现 Excel 导入导出">
                        Previous<br>
                        <span>AngularJS 实现 Excel 导入导出</span>
                        </a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/skill/swift/swift-basic-grammar.html" data-toggle="tooltip" data-placement="top" title="Swift 5 - 基础语法">
                        Next<br>
                        <span>Swift 5 - 基础语法</span>
                        </a>
                    </li>
                    
                </ul>
                <hr style="visibility: hidden;">

                <!-- Comment start -->
<div class="comment">
  

  
  <!-- gitalk 评论框 start -->
  <div id="gitalk-container"></div>
  <!-- gitalk 评论框 end -->
  

  
</div>
<!-- Comment end -->






<!-- Gitalk CSS -->
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<!-- gitalk 公共JS代码 start (一个网页只需插入一次) -->
<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script type="text/javascript">
  function getLangForGitalk() {
    lang = new URLSearchParams(document.location.search).get("lang");
    return lang == 'zh' ? 'zh-CN' : lang;
  }

  var body = location.href;

  var subtitle = "";
  if (subtitle) {
    body += "\n" + subtitle;
  }

  var description = "";
  if (description) {
    body += "\n" + description;
  }

  var gitalk = new Gitalk({
      clientID: 'f86fb5601466c278f223',
      clientSecret: '8234184af9a4cbc9dfa58bbea7ff6cdb84d33f1f',
      repo: 'oscaner.github.io',
      owner: 'Oscaner',
      admin: 'Oscaner',
      labels: 'Gitalk|Skill|PHP|Drupal|Oscaner'.split('|'),
      body: body,
      language: getLangForGitalk() ? getLangForGitalk() : 'zh-CN',

      id: MD5('/skill/php/drupal-config.html'),
      // facebook-like distraction free mode
      distractionFreeMode: true
  });

  gitalk.render('gitalk-container');
</script>
<!-- gitalk 公共JS代码 end -->





            </div>

    <!-- Side Catalog Container -->
        
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
        

    <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                


<section>
    
        <hr class="hidden-sm hidden-xs">
    
    <h5><a href="/archive/">FEATURED TAGS</a></h5>
    <div class="tags">
        
        
        
        
        
        
                <a data-sort="0040" href="/archive/?tag=Skill" title="Skill" rel="95">Skill</a>
        
                <a data-sort="0097" href="/archive/?tag=Clang" title="Clang" rel="38">Clang</a>
        
                <a data-sort="0097" href="/archive/?tag=Exam" title="Exam" rel="38">Exam</a>
        
                <a data-sort="0098" href="/archive/?tag=AWS" title="AWS" rel="37">AWS</a>
        
                <a data-sort="0098" href="/archive/?tag=C%2B%2B" title="C++" rel="37">C++</a>
        
                <a data-sort="0098" href="/archive/?tag=Data+Structure" title="Data Structure" rel="37">Data Structure</a>
        
                <a data-sort="0099" href="/archive/?tag=MLS" title="MLS" rel="36">MLS</a>
        
                <a data-sort="0099" href="/archive/?tag=Machine+Learning" title="Machine Learning" rel="36">Machine Learning</a>
        
                <a data-sort="0122" href="/archive/?tag=PHP" title="PHP" rel="13">PHP</a>
        
                <a data-sort="0124" href="/archive/?tag=Coding" title="Coding" rel="11">Coding</a>
        
                <a data-sort="0124" href="/archive/?tag=Others" title="Others" rel="11">Others</a>
        
                <a data-sort="0125" href="/archive/?tag=Graduate" title="Graduate" rel="10">Graduate</a>
        
                <a data-sort="0125" href="/archive/?tag=Math" title="Math" rel="10">Math</a>
        
                <a data-sort="0126" href="/archive/?tag=NoSQL" title="NoSQL" rel="9">NoSQL</a>
        
                <a data-sort="0129" href="/archive/?tag=SQL" title="SQL" rel="6">SQL</a>
        
                <a data-sort="0130" href="/archive/?tag=Linux" title="Linux" rel="5">Linux</a>
        
                <a data-sort="0130" href="/archive/?tag=Redis" title="Redis" rel="5">Redis</a>
        
                <a data-sort="0132" href="/archive/?tag=Fibonacci" title="Fibonacci" rel="3">Fibonacci</a>
        
                <a data-sort="0132" href="/archive/?tag=Git" title="Git" rel="3">Git</a>
        
                <a data-sort="0132" href="/archive/?tag=Memcached" title="Memcached" rel="3">Memcached</a>
        
                <a data-sort="0133" href="/archive/?tag=MySQL" title="MySQL" rel="2">MySQL</a>
    </div>
</section>


                <!-- Friends Blog -->
                
<hr>
<h5>FRIENDS</h5>
<ul class="list-inline">
  
  <li><a href="https://asdrt666.com" target="_blank" rel="friend">Asdrt</a></li>
  
  <li><a href="https://szdblog.com" target="_blank" rel="friend">Choba·乔巴博客</a></li>
  
  <li><a href="https://ibcl.us/" target="_blank" rel="friend">I BCL.</a></li>
  
  <li><a href="https://www.wmathor.com/" target="_blank" rel="friend">mathor</a></li>
  
  <li><a href="https://tongtaos.com" target="_blank" rel="friend">Mr. 童的博客</a></li>
  
  <li><a href="https://blog.kejijie.vip/" target="_blank" rel="friend">wantsget</a></li>
  
  <li><a href="https://o0o0o0.cn/" target="_blank" rel="friend">三十三言</a></li>
  
  <li><a href="http://www.gazyip.cn/" target="_blank" rel="friend">八个比特</a></li>
  
  <li><a href="https://www.lixuejiang.com/" target="_blank" rel="friend">李学江博客</a></li>
  
  <li><a href="https://5sir.cn" target="_blank" rel="friend">梁Sir的小站</a></li>
  
  <li><a href="http://isenchun.cn/" target="_blank" rel="friend">森纯个人博客</a></li>
  
  <li><a href="http://www.nothamor.cn/" target="_blank" rel="friend">欧尼酱</a></li>
  
  <li><a href="https://www.lkxin.cn" target="_blank" rel="friend">清酒踏月</a></li>
  
  <li><a href="https://www.yyhy.me" target="_blank" rel="friend">烟雨寒云博客</a></li>
  
  <li><a href="http://mlldxe.cn" target="_blank" rel="friend">犬の窝</a></li>
  
  <li><a href="https://aoppp.com" target="_blank" rel="friend">憧憬播客</a></li>
  
</ul>



                <!-- Ads -->
                <hr>

<!-- <script async
  src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3286495153411959"
  crossorigin="anonymous"></script> -->

<!-- Oscaner's Vertical Ad -->

<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3286495153411959" data-ad-slot="2277392638" data-ad-format="auto" data-full-width-responsive="true"></ins>



<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

            </div>
        </div>
    </div>
</article>

<!-- add support for mathjax by voleking-->



<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async('/packages/anchor/1.1.1/anchor.min.js', function(){
        anchors.options = {
          visible: 'hover',
          placement: 'right',
          // icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>


<!-- SEO -->
<!-- Schema Markup -->

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "name": "Drupal 配置开发",
  "author": {
    "@type": "Person",
    "name": "Oscaner"
  },
  "datePublished": "June 30, 2019",
  "image": "https://www.oscaner.com/assets/img/post-bg-alitrip.jpg",
  "articleBody": "&lt;h2 id=&quot;基本概念&quot;&gt;基本概念&lt;/h2&gt;\n\n&lt;p&gt;配置文档见&#58; &lt;a href=&quot;https&#58;//www.drupal.org/docs/8/api/configuration-api/configuration-api-overview&quot; class=&quot;web-link&quot;&gt;Configuration API overview&lt;/a&gt;&lt;/p&gt;\n\n&lt;p&gt;配置 API 主要做配置数据的管理, 比如网站的站点名称等。&lt;/p&gt;\n\n&lt;p&gt;通常配置都是由开发人员创建的, 除了超级管理员可以在后台修改配置, 其它用户是没有操作权限的。&lt;/p&gt;\n\n&lt;p&gt;配置 API 有两种&#58;&lt;/p&gt;\n\n&lt;ol&gt;\n  &lt;li&gt;Config API&lt;/li&gt;\n  &lt;li&gt;Configuration Entity API&lt;/li&gt;\n&lt;/ol&gt;\n\n&lt;p&gt;其中, Config API 可以认为是一个单独的配置实例, 一般只保存简单的 Boolean 值、数字、字符串等, 如站点名称(site name)&lt;/p&gt;\n\n&lt;p&gt;Configuration Entity API 主要用来存储多个配置集, 例如节点类型、视图、词汇和字段等。&lt;/p&gt;\n\n&lt;p&gt;Drupal8 的配置信息默认是保存在数据库中, 配置文件格式是 YAML&lt;/p&gt;\n\n&lt;h2 id=&quot;配置存储&quot;&gt;配置存储&lt;/h2&gt;\n\n&lt;h3 id=&quot;基础配置hello_worldsettingyml&quot;&gt;基础配置(hello_world.setting.yml)&lt;/h3&gt;\n\n&lt;p&gt;以下是创建一个简单配置的示例&#58;&lt;/p&gt;\n\n&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;docroot/modules/custom/hello_world\n&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;mkdir&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; config/install\n&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;touch &lt;/span&gt;config/install/hello_world.settings.yml\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;\n\n&lt;p&gt;然后把以下代码写入到 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;hello_world.settings.yml&lt;/code&gt; 中&lt;/p&gt;\n\n&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;na&quot;&gt;some_string&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Woo&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;kittens!&#39;&lt;/span&gt;\n&lt;span class=&quot;na&quot;&gt;some_int&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;42&lt;/span&gt;\n&lt;span class=&quot;na&quot;&gt;some_bool&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;\n\n&lt;p&gt;也可以定义一个嵌套的结构, 如&#58;&lt;/p&gt;\n\n&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;thumbnail&lt;/span&gt;\n&lt;span class=&quot;na&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Thumbnail&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;(100*100)&#39;&lt;/span&gt;\n&lt;span class=&quot;na&quot;&gt;effects&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n  &lt;span class=&quot;na&quot;&gt;1cfec298-8620-4749-b100-ccb6c4500779&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n    &lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;image_scale&lt;/span&gt;\n    &lt;span class=&quot;na&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n      &lt;span class=&quot;na&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;100&lt;/span&gt;\n      &lt;span class=&quot;na&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;100&lt;/span&gt;\n      &lt;span class=&quot;na&quot;&gt;upscale&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;\n    &lt;span class=&quot;na&quot;&gt;weight&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;\n    &lt;span class=&quot;na&quot;&gt;uuid&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;1cfec298-8620-4749-b100-ccb6c4500779&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;\n\n&lt;p&gt;也可以动态的去修改 *.setting.yml` 中的配置。&lt;/p&gt;\n\n&lt;p&gt;如在 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;hello_world/hello_world.install&lt;/code&gt; 中定义如下代码&#58;&lt;/p&gt;\n\n&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n4\n5\n6\n7\n8\n9\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;cd&quot;&gt;/**\n * Implements hook_install().\n */&lt;/span&gt;\n&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hello_world_install&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;\n  &lt;span class=&quot;c1&quot;&gt;// Set default values for config which require dynamic values.&lt;/span&gt;\n  &lt;span class=&quot;err&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Drupal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&#58;&#58;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;configFactory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;getEditable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;hello_world.settings&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;\n   &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;default_form_address&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Drupal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&#58;&#58;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;system.site&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;mail&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;\n   &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;\n&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;\n\n&lt;h3 id=&quot;可选配置&quot;&gt;可选配置&lt;/h3&gt;\n\n&lt;p&gt;可选配置一般保存在 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;config/optional&lt;/code&gt; 中, 它只在依赖存在的情况下才会生效。&lt;/p&gt;\n\n&lt;p&gt;如 A 模块有一个可选配置依赖于 B 模块, A 模块先安装, 当安装 B 模块时, 会自动扫描 A 模块的 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;config/optional&lt;/code&gt;, 找到依赖并安装。&lt;/p&gt;\n\n&lt;p&gt;如果 B 模块没有安装, 那么 A 模块的可选配置将不会启用&lt;/p&gt;\n\n&lt;p&gt;核心模块中有很多的示例, 比如 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;block_content&lt;/code&gt; 模块中, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;views.view.block_content.yml&lt;/code&gt; 中有如下配置, 只列举一部分&#58;&lt;/p&gt;\n\n&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;na&quot;&gt;langcode&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;en&lt;/span&gt;\n&lt;span class=&quot;na&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;\n&lt;span class=&quot;na&quot;&gt;dependencies&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n  &lt;span class=&quot;na&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;block_content&lt;/span&gt;\n    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;user&lt;/span&gt;\n&lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;block_content&lt;/span&gt;\n&lt;span class=&quot;na&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Custom&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;block&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;library&#39;&lt;/span&gt;\n&lt;span class=&quot;na&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;views&lt;/span&gt;\n&lt;span class=&quot;na&quot;&gt;description&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Find&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;and&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;manage&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;custom&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;blocks.&#39;&lt;/span&gt;\n&lt;span class=&quot;na&quot;&gt;tag&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;default&lt;/span&gt;\n&lt;span class=&quot;na&quot;&gt;base_table&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;block_content_field_data&lt;/span&gt;\n&lt;span class=&quot;na&quot;&gt;base_field&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;id&lt;/span&gt;\n&lt;span class=&quot;na&quot;&gt;core&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;8.x&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;\n\n&lt;h3 id=&quot;更新配置&quot;&gt;更新配置&lt;/h3&gt;\n\n&lt;p&gt;可以使用 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;drush config-import&lt;/code&gt; 这个命令把配置更新到数据库中。&lt;/p&gt;\n\n&lt;p&gt;首先在 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;setting.php&lt;/code&gt; 中找到如下配置, 如&#58;&lt;/p&gt;\n\n&lt;p&gt;(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;setting.php&lt;/code&gt; 是 Drupal8 的配置文件, 一般是在 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sites/default&lt;/code&gt; 下)&lt;/p&gt;\n\n&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$config_directories&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;sync&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;sites/default/files/config_bBkGn-0ZX0fe_fnnlVS3dmxhz7_z6guu819vcYXEpc4NtTBYgr8vB2Tqwp0t8-Oz9j71_los1g/sync&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;\n\n&lt;p&gt;接下来把 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;hello_world.setting.yml&lt;/code&gt; 放到这个目录下, 然后执行 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;drush cim &amp;amp;&amp;amp; drush cr&lt;/code&gt; 命令。&lt;/p&gt;\n\n&lt;p&gt;访问数据库 config, 查询配置是否更新成功。&lt;/p&gt;\n\n&lt;h2 id=&quot;覆写系统配置&quot;&gt;覆写系统配置&lt;/h2&gt;\n\n&lt;h3 id=&quot;覆写-global&quot;&gt;覆写 Global&lt;/h3&gt;\n\n&lt;p&gt;Drupal8 可以使用 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$config&lt;/code&gt; 这个全局变量来访问配置。&lt;/p&gt;\n\n&lt;p&gt;通常通过 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Drupal\\Core\\Config\\COnfigFactory&#58;&#58;get()&lt;/code&gt; 这个 API 来获取配置的值。&lt;/p&gt;\n\n&lt;p&gt;比如, 我们获取网站维护的 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;message&lt;/code&gt;&#58;&lt;/p&gt;\n\n&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$message&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Drupal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&#58;&#58;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;system.maintenance&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;message&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;\n\n&lt;p&gt;可以在 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;setting.php&lt;/code&gt; 中直接来覆写这个变量&#58;&lt;/p&gt;\n\n&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;system.maintenance&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;message&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;Sorry, our site is down now.&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;\n\n&lt;p&gt;在 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Configuration-&amp;gt;Performance-&amp;gt;Aggregate CSS files&lt;/code&gt; 这里, 安装完以后 Drupal8 是默认打开的, 关闭代码如下&#58;&lt;/p&gt;\n\n&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;system.performance&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;css&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;preprocess&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;\n\n&lt;p&gt;然后通过 drush 命令查看是否覆写成功。&lt;/p&gt;\n\n&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; drush config-list\n&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; drush config-get system.performance\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;\n\n&lt;h3 id=&quot;获取原值&quot;&gt;获取原值&lt;/h3&gt;\n\n&lt;p&gt;配置被覆写以后, 怎么获取原值呢？以下是示例代码&#58;&lt;/p&gt;\n\n&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n4\n5\n6\n7\n8\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;c1&quot;&gt;// Get the site name, with overrides.&lt;/span&gt;\n&lt;span class=&quot;nv&quot;&gt;$site_name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Drupal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&#58;&#58;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;system.site&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;name&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n\n&lt;span class=&quot;c1&quot;&gt;// Get the site name without overrides.&lt;/span&gt;\n&lt;span class=&quot;nv&quot;&gt;$site_name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Drupal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&#58;&#58;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;system.site&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;getOriginal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;name&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;FALSE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n\n&lt;span class=&quot;c1&quot;&gt;// Note that mutable config is always override free.&lt;/span&gt;\n&lt;span class=&quot;nv&quot;&gt;$site_name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Drupal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&#58;&#58;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;configFactory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;getEditable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;system.site&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;name&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;\n\n&lt;h3 id=&quot;覆写语言配置&quot;&gt;覆写语言配置&lt;/h3&gt;\n\n&lt;p&gt;多语言站点中, 要给用户发送邮件, 这时候邮件语言取决于用户的语言配置。代码如下&#58;&lt;/p&gt;\n\n&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;c1&quot;&gt;// Load the language_manager service&lt;/span&gt;\n&lt;span class=&quot;nv&quot;&gt;$language_manager&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Drupal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&#58;&#58;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;service&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;language_manager&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n\n&lt;span class=&quot;c1&quot;&gt;// Get the target language object&lt;/span&gt;\n&lt;span class=&quot;nv&quot;&gt;$langcode&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$account&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;getPerferredLangcode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;\n&lt;span class=&quot;nv&quot;&gt;$language&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$language_manager&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;getLanguage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$langcode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n\n&lt;span class=&quot;c1&quot;&gt;// Remember original language before this operation.&lt;/span&gt;\n&lt;span class=&quot;nv&quot;&gt;$original_language&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$language_manager&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;getConfigOverrideLanguage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;\n&lt;span class=&quot;c1&quot;&gt;// Set the translation target language on the configuration factory.&lt;/span&gt;\n&lt;span class=&quot;nv&quot;&gt;$language_manager&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;setConfigOverrideLanguage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$language&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n\n&lt;span class=&quot;nv&quot;&gt;$mail_config&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Drupal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&#58;&#58;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;user.mail&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n\n&lt;span class=&quot;c1&quot;&gt;// Now send email based on $mail_config which is in the proper language.&lt;/span&gt;\n\n&lt;span class=&quot;c1&quot;&gt;// Set the configuration language back.&lt;/span&gt;\n&lt;span class=&quot;nv&quot;&gt;$language_manager&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;setCOnfigOverrideLanguage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$original_language&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;\n\n&lt;p&gt;这段代码主要是把 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user.mail&lt;/code&gt; 这个配置更改为 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;language.config.$langcode.user.mail&lt;/code&gt;, 发送邮件的时候就会自动找用户设置的语言, 从而找到跟用户语言相符合的邮件模版。&lt;/p&gt;\n\n&lt;h3 id=&quot;模块中覆写配置&quot;&gt;模块中覆写配置&lt;/h3&gt;\n\n&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ConfigFactory&lt;/code&gt; 会扫描所有模块, 并从中找到实现了 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;config.factory.override&lt;/code&gt; 的 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;service&lt;/code&gt;。&lt;/p&gt;\n\n&lt;p&gt;如在 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;hello_world.services.yml&lt;/code&gt; 中定义如下&#58;&lt;/p&gt;\n\n&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n4\n5\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;na&quot;&gt;services&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n  &lt;span class=&quot;na&quot;&gt;hello_world.config_example.overrider&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n    &lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;\\Drupal\\hello_world\\ConfigExampleOverrides&lt;/span&gt;\n    &lt;span class=&quot;na&quot;&gt;tags&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;config.factory.override&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;priority&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;}&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;\n\n&lt;p&gt;在 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;src/ConfigExampleOverrides.php&lt;/code&gt; 编写如下代码&#58;&lt;/p&gt;\n\n&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;\n&lt;span class=&quot;kn&quot;&gt;namespace&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Drupal\\hello_world&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n\n&lt;span class=&quot;kn&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Drupal\\Core\\Cache\\CacheableMetadata&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n&lt;span class=&quot;kn&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Drupal\\Core\\Config\\COnfigFactoryOverrideInterface&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n&lt;span class=&quot;kn&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Drupal\\Core\\Config\\StorageInterface&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n\n&lt;span class=&quot;cd&quot;&gt;/**\n * Example configuration override.\n */&lt;/span&gt;\n&lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ConfigExampleOverrides&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ConfigFactoryOverrideInterface&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;\n\n  &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loadOverrides&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$names&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;nv&quot;&gt;$overrides&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;\n    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;in_array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;system.site&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$names&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;\n      &lt;span class=&quot;nv&quot;&gt;$overrides&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;system.site&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;name&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;Overridden site name!&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;\n    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;\n    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$overrides&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;\n\n  &lt;span class=&quot;cd&quot;&gt;/**\n   * {@inheritdoc}\n   */&lt;/span&gt;\n  &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getCacheSuffix&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;ConfigExampleOverrider&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;\n\n  &lt;span class=&quot;cd&quot;&gt;/**\n   * {@inheritdoc}\n   */&lt;/span&gt;\n  &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getCacheableMetadata&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;CacheableMetadata&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;\n  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;\n\n  &lt;span class=&quot;cd&quot;&gt;/**\n   * {@inheritdoc}\n   */&lt;/span&gt;\n  &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;createConfigObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$collection&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;StorageInterface&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&#58;&#58;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;DEFAULT_COLLECTION&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;\n\n&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;\n\n&lt;p&gt;上面代码实现了 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ConfigFactoryOverrideInterface&lt;/code&gt; 的四个方法&#58;&lt;/p&gt;\n\n&lt;ol&gt;\n  &lt;li&gt;\n&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;loadOverrides&lt;/code&gt;&#58; 返回配置覆写数组&lt;/li&gt;\n  &lt;li&gt;\n&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;getCacheSuffix&lt;/code&gt;&#58; 返回 cache 的前缀名称&lt;/li&gt;\n  &lt;li&gt;\n&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;getCacheableMetadata&lt;/code&gt;&#58; 返回被覆写后的 cache 数据&lt;/li&gt;\n  &lt;li&gt;\n&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;createConfigObject&lt;/code&gt;&#58; 安装或同步的时候创建一个 config 对象, 这里是覆写, 所以返回 NULL&lt;/li&gt;\n&lt;/ol&gt;\n\n&lt;h2 id=&quot;配置-shema--metadata&quot;&gt;配置 shema / metadata&lt;/h2&gt;\n\n&lt;ol&gt;\n  &lt;li&gt;\n&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;schema&lt;/code&gt; 描述配置文件的结构&lt;/li&gt;\n  &lt;li&gt;\n&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;metadata&lt;/code&gt; 配置的元数据&lt;/li&gt;\n&lt;/ol&gt;\n\n&lt;h3 id=&quot;一个简单的示例&quot;&gt;一个简单的示例&lt;/h3&gt;\n\n&lt;p&gt;有如下代码&#58;&lt;/p&gt;\n\n&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$config&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Drupal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&#58;&#58;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;system.maintenance&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n&lt;span class=&quot;nv&quot;&gt;$message&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$config&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;message&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n&lt;span class=&quot;nv&quot;&gt;$langcode&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$config&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;langcode&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;\n\n&lt;p&gt;config 数据结构体的默认值是保存在配置文件 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;core/modules/system/config/install/system.maintenance.yml&lt;/code&gt;&lt;/p&gt;\n\n&lt;p&gt;代码如下&#58;&lt;/p&gt;\n\n&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;na&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@site&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;is&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;currently&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;under&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;maintenance.&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;We&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;should&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;be&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;back&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;shortly.&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Thank&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;you&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;your&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;patience.&#39;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;\n&lt;span class=&quot;s&quot;&gt;langcode&#58;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;en&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;\n\n&lt;p&gt;在 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;core/modules/system/config/schema/system.schema.yml&lt;/code&gt; 文件中定义数据结构题。&lt;/p&gt;\n\n&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n4\n5\n6\n7\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;na&quot;&gt;system.maintenance&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n  &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;config_object&lt;/span&gt;\n  &lt;span class=&quot;na&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Maintenance&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;mode&#39;&lt;/span&gt;\n  &lt;span class=&quot;na&quot;&gt;mapping&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n    &lt;span class=&quot;na&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n      &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;text&lt;/span&gt;\n      &lt;span class=&quot;na&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;display&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;when&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;maintenance&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;mode&#39;&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;\n\n&lt;p&gt;schema 定义了一个 mapping 数据结构体, 可以认为是一个数组。&lt;/p&gt;\n\n&lt;p&gt;注意&#58; 一个 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;schema.yml&lt;/code&gt; 文件可以定义多个数据结构体, 每一个数据结构体的机器名必须与 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;setting.yml&lt;/code&gt; 文件名一致&lt;/p&gt;\n\n&lt;h3 id=&quot;schema-属性&quot;&gt;schema 属性&lt;/h3&gt;\n\n&lt;h4 id=&quot;type&quot;&gt;Type&lt;/h4&gt;\n\n&lt;p&gt;有基本类型和派生类型&lt;/p&gt;\n\n&lt;ol&gt;\n  &lt;li&gt;\n    &lt;p&gt;基本类型 (core.data_types.schema.yml)&lt;/p&gt;\n\n    &lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;\n&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt; &lt;span class=&quot;c1&quot;&gt;# Undefined type used by the system to assign to elements at any level where&lt;/span&gt;\n &lt;span class=&quot;c1&quot;&gt;# configuration schema is not defined. Using explicitly has the same effect as&lt;/span&gt;\n &lt;span class=&quot;c1&quot;&gt;# not defining schema, so there is no point in doing that.&lt;/span&gt;\n &lt;span class=&quot;na&quot;&gt;underfined&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n   &lt;span class=&quot;na&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Underfined&#39;&lt;/span&gt;\n   &lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\\Drupal\\Core\\Config\\Schema\\Underfined&#39;&lt;/span&gt;\n\n &lt;span class=&quot;c1&quot;&gt;# Explicit type to use when no data typing is possible. Instead of using this&lt;/span&gt;\n &lt;span class=&quot;c1&quot;&gt;# type, we strongly suggest you use configuration structures that can be&lt;/span&gt;\n &lt;span class=&quot;c1&quot;&gt;# described with other structural elements of schema, and describe your schema&lt;/span&gt;\n &lt;span class=&quot;c1&quot;&gt;# with those elements.&lt;/span&gt;\n &lt;span class=&quot;na&quot;&gt;ignore&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n   &lt;span class=&quot;na&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Ignore&#39;&lt;/span&gt;\n   &lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\\Drupal\\Core\\Config\\Schema\\Ignore&#39;&lt;/span&gt;\n\n &lt;span class=&quot;c1&quot;&gt;# Basic scalar data types from typed data.&lt;/span&gt;\n &lt;span class=&quot;na&quot;&gt;boolean&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n   &lt;span class=&quot;na&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Boolean&#39;&lt;/span&gt;\n   &lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\\Drupal\\Core\\TypedData\\Plugin\\DataType\\BooleanData&#39;&lt;/span&gt;\n &lt;span class=&quot;na&quot;&gt;email&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n   &lt;span class=&quot;na&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Email&#39;&lt;/span&gt;\n   &lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\\Drupal\\Core\\TypedData\\Plugin\\DataType\\Email&#39;&lt;/span&gt;\n &lt;span class=&quot;na&quot;&gt;integer&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n   &lt;span class=&quot;na&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Integer&#39;&lt;/span&gt;\n   &lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\\Drupal\\Core\\TypedData\\Plugin\\DataType\\IntegerData&#39;&lt;/span&gt;\n &lt;span class=&quot;na&quot;&gt;float&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n   &lt;span class=&quot;na&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Float&#39;&lt;/span&gt;\n   &lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\\Drupal\\Core\\TypedData\\Plugin\\DataType\\FloatData&#39;&lt;/span&gt;\n &lt;span class=&quot;na&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n   &lt;span class=&quot;na&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;String&#39;&lt;/span&gt;\n   &lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\\Drupal\\Core\\TypedData\\Plugin\\DataType\\StringData&#39;&lt;/span&gt;\n &lt;span class=&quot;na&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n   &lt;span class=&quot;na&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Uri&#39;&lt;/span&gt;\n   &lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\\Drupal\\Core\\TypedData\\Plugin\\DataType\\Uri&#39;&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;\n\n    &lt;ol&gt;\n      &lt;li&gt;\n&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;label&lt;/code&gt;&#58; 短标签&lt;/li&gt;\n      &lt;li&gt;\n&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;translatable&lt;/code&gt;&#58; 是否可被翻译&lt;/li&gt;\n      &lt;li&gt;\n&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nullable&lt;/code&gt;&#58; 是否允许空值&lt;/li&gt;\n      &lt;li&gt;\n&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;class&lt;/code&gt;&#58; 实现的类名&lt;/li&gt;\n    &lt;/ol&gt;\n\n    &lt;p&gt;另外还有&#58;&lt;/p&gt;\n\n    &lt;ul&gt;\n      &lt;li&gt;\n&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;config_object&lt;/code&gt;&#58; 默认配置结构&lt;/li&gt;\n      &lt;li&gt;\n&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;config_entity&lt;/code&gt;&#58; 实体配置结构&lt;/li&gt;\n    &lt;/ul&gt;\n  &lt;/li&gt;\n  &lt;li&gt;\n    &lt;p&gt;派生类型&lt;/p&gt;\n\n    &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mapping&lt;/code&gt;&#58; 关联数组 (associative array), key/value数据结构, 只支持 string 类型&lt;/p&gt;\n\n    &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sequence&lt;/code&gt;&#58; 索引数组 (indexed array)&lt;/p&gt;\n  &lt;/li&gt;\n&lt;/ol&gt;\n\n&lt;h3 id=&quot;动态类型-parent&quot;&gt;动态类型 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[%parent]&lt;/code&gt;\n&lt;/h3&gt;\n\n&lt;p&gt;下面的示例我们定义了两个动态类型 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;warning&lt;/code&gt; 和 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;multiple&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;multiple&lt;/code&gt; 是一个列表, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;warning&lt;/code&gt; 是一个当行文本。&lt;/p&gt;\n\n&lt;ol&gt;\n  &lt;li&gt;\n    &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;config/install/hello_world.message.single.yml&lt;/code&gt;&lt;/p&gt;\n\n    &lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;\n&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt; &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;warning&lt;/span&gt;\n &lt;span class=&quot;na&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Hello!&#39;&lt;/span&gt;\n &lt;span class=&quot;na&quot;&gt;langcode&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;en&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;\n  &lt;/li&gt;\n  &lt;li&gt;\n    &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;config/install/hello_world.message.multiple.yml&lt;/code&gt;&lt;/p&gt;\n\n    &lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;\n&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n4\n5\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt; &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;multiple&lt;/span&gt;\n &lt;span class=&quot;na&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n   &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Hello!&#39;&lt;/span&gt;\n   &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Hi!&#39;&lt;/span&gt;\n &lt;span class=&quot;na&quot;&gt;langcode&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;en&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;\n  &lt;/li&gt;\n  &lt;li&gt;\n    &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;config/schema/hello_world.schema.yml&lt;/code&gt;&lt;/p&gt;\n\n    &lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;\n&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt; &lt;span class=&quot;na&quot;&gt;hello_world.message.*&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n   &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;config_object&lt;/span&gt;\n   &lt;span class=&quot;na&quot;&gt;mapping&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n     &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n       &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;string&lt;/span&gt;\n       &lt;span class=&quot;na&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;type&#39;&lt;/span&gt;\n     &lt;span class=&quot;na&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n       &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;hello_world_message.[%parent.type]&lt;/span&gt;\n     &lt;span class=&quot;na&quot;&gt;langcode&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n       &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;string&lt;/span&gt;\n       &lt;span class=&quot;na&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Language&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;code&#39;&lt;/span&gt;\n\n &lt;span class=&quot;na&quot;&gt;hello_world_message.warning&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n   &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;string&lt;/span&gt;\n\n &lt;span class=&quot;na&quot;&gt;hello_world.message.multiple&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n   &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;sequence&lt;/span&gt;\n   &lt;span class=&quot;na&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Messages&#39;&lt;/span&gt;\n   &lt;span class=&quot;na&quot;&gt;sequence&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n     &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;string&lt;/span&gt;\n     &lt;span class=&quot;na&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Message&#39;&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;\n\n    &lt;ul&gt;\n      &lt;li&gt;\n&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;*&lt;/code&gt; 表示通配符, 这里指 single 或 multiple&lt;/li&gt;\n      &lt;li&gt;\n&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$parent.type&lt;/code&gt; 指我们在下面定义的数据类型, 注意&#58; 这里定义的机器名要和父节点的机器名不能重名&lt;/li&gt;\n    &lt;/ul&gt;\n  &lt;/li&gt;\n&lt;/ol&gt;\n\n&lt;h3 id=&quot;动态类型-type&quot;&gt;动态类型 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[type]&lt;/code&gt;\n&lt;/h3&gt;\n\n&lt;p&gt;如果想要在已有的数据下面定义你自己不同的数据类型, 那么 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[type]&lt;/code&gt; 将会变得非常有用。&lt;/p&gt;\n\n&lt;ol&gt;\n  &lt;li&gt;\n    &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;config/install/hello_world.message.single.yml&lt;/code&gt;&lt;/p&gt;\n\n    &lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;\n&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n4\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt; &lt;span class=&quot;na&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n   &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;warning&lt;/span&gt;\n   &lt;span class=&quot;na&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Hello!&#39;&lt;/span&gt;\n &lt;span class=&quot;na&quot;&gt;langcode&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;en&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;\n  &lt;/li&gt;\n  &lt;li&gt;\n    &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;config/install/hello_world.message.multiple.yml&lt;/code&gt;&lt;/p&gt;\n\n    &lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;\n&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n4\n5\n6\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt; &lt;span class=&quot;na&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n   &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;multiple&lt;/span&gt;\n   &lt;span class=&quot;na&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n     &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Hello!&#39;&lt;/span&gt;\n     &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Hi&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;!&#39;&lt;/span&gt;\n &lt;span class=&quot;na&quot;&gt;langcode&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;en&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;\n  &lt;/li&gt;\n  &lt;li&gt;\n    &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;config/schema/hello_world.schema.yml&lt;/code&gt;&lt;/p&gt;\n\n    &lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;\n&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt; &lt;span class=&quot;na&quot;&gt;hello_world.message.*&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n   &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;config_object&lt;/span&gt;\n   &lt;span class=&quot;na&quot;&gt;mapping&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n     &lt;span class=&quot;na&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n       &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;hello_world_message.[type]&lt;/span&gt;\n     &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;\n\n &lt;span class=&quot;na&quot;&gt;hello_world_message.warning&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n   &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;mapping&lt;/span&gt;\n   &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;\n\n &lt;span class=&quot;na&quot;&gt;hello_world_message.multiple&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n   &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;mapping&lt;/span&gt;\n   &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;\n\n    &lt;ul&gt;\n      &lt;li&gt;\n&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[type]&lt;/code&gt; 动态定义了 message 的类型, 并且要求 warning 和 multiple 的类型必须一致, 上面的示例代码都是 mapping 类型&lt;/li&gt;\n    &lt;/ul&gt;\n  &lt;/li&gt;\n&lt;/ol&gt;\n\n&lt;h3 id=&quot;动态类型-key&quot;&gt;动态类型 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[%key]&lt;/code&gt;\n&lt;/h3&gt;\n\n&lt;ol&gt;\n  &lt;li&gt;\n    &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;config/install/hello_world.messages.yml&lt;/code&gt;&lt;/p&gt;\n\n    &lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;\n&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n4\n5\n6\n7\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt; &lt;span class=&quot;na&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n   &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;single&#58;1&#39;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Hello!&#39;&lt;/span&gt;\n   &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;single&#58;2&#39;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Hi&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;!&#39;&lt;/span&gt;\n   &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;multiple&#58;1&#39;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&#58;&lt;/span&gt;\n     &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Good&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;morning!&#39;&lt;/span&gt;\n     &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Good&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;night!&#39;&lt;/span&gt;\n &lt;span class=&quot;na&quot;&gt;langcode&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;en&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;\n\n    &lt;p&gt;这是一个任意消息元素的列表。&lt;/p&gt;\n  &lt;/li&gt;\n  &lt;li&gt;\n    &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;config/schema/hello_world.schema.yml&lt;/code&gt;&lt;/p&gt;\n\n    &lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;\n&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt; &lt;span class=&quot;na&quot;&gt;hello_world_message.messages&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n     &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;config_object&lt;/span&gt;\n     &lt;span class=&quot;na&quot;&gt;mapping&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n       &lt;span class=&quot;na&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n         &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;sequence&lt;/span&gt;\n         &lt;span class=&quot;na&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Messages&#39;&lt;/span&gt;\n         &lt;span class=&quot;na&quot;&gt;sequence&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n           &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;hello_world_message.[%key]&lt;/span&gt;\n       &lt;span class=&quot;na&quot;&gt;langcode&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n         &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;string&lt;/span&gt;\n         &lt;span class=&quot;na&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Language&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;code&#39;&lt;/span&gt;\n\n     &lt;span class=&quot;s&quot;&gt;hello_world_message.single&#58;*&#58;&lt;/span&gt;\n       &lt;span class=&quot;s&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;string&lt;/span&gt;\n       &lt;span class=&quot;s&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Message&#39;&lt;/span&gt;\n\n     &lt;span class=&quot;s&quot;&gt;hello_world_message.multiple&#58;*&#58;&lt;/span&gt;\n       &lt;span class=&quot;s&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;sequence&lt;/span&gt;\n       &lt;span class=&quot;s&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Messages&#39;&lt;/span&gt;\n       &lt;span class=&quot;na&quot;&gt;sequence&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n         &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;string&lt;/span&gt;\n         &lt;span class=&quot;na&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Message&#39;&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;\n\n    &lt;p&gt;这里定义了一个序列数组 messages, 而序列数组的类型就是 hello_world_message 定义的动态类型。&lt;/p&gt;\n  &lt;/li&gt;\n&lt;/ol&gt;\n\n&lt;h2 id=&quot;创建配置实体&quot;&gt;创建配置实体&lt;/h2&gt;\n\n&lt;h3 id=&quot;定义路由&quot;&gt;定义路由&lt;/h3&gt;\n\n&lt;p&gt;在 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;example/example.routing.yml&lt;/code&gt; 中定义四个路由&#58; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;list / add / edit / delete&lt;/code&gt;。&lt;/p&gt;\n\n&lt;p&gt;代码如下&#58;&lt;/p&gt;\n\n&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;na&quot;&gt;entity.example.collection&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n  &lt;span class=&quot;na&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/admin/config/system/example&#39;&lt;/span&gt;\n  &lt;span class=&quot;na&quot;&gt;defaults&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n    &lt;span class=&quot;na&quot;&gt;_entity_list&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;example&#39;&lt;/span&gt;\n    &lt;span class=&quot;na&quot;&gt;_title&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Example&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;configuration&#39;&lt;/span&gt;\n  &lt;span class=&quot;na&quot;&gt;requirements&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n    &lt;span class=&quot;na&quot;&gt;_permission&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;administer&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;site&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;configuration&#39;&lt;/span&gt;\n\n&lt;span class=&quot;na&quot;&gt;entity.example.add_form&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n  &lt;span class=&quot;na&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/admin/config/system/example/add&#39;&lt;/span&gt;\n  &lt;span class=&quot;na&quot;&gt;defaults&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n    &lt;span class=&quot;na&quot;&gt;_entity_form&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;example.add&#39;&lt;/span&gt;\n    &lt;span class=&quot;na&quot;&gt;_title&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Add&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;example&#39;&lt;/span&gt;\n  &lt;span class=&quot;na&quot;&gt;requirements&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n    &lt;span class=&quot;na&quot;&gt;_permission&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;administer&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;site&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;configuration&#39;&lt;/span&gt;\n\n&lt;span class=&quot;na&quot;&gt;entity.example.edit_form&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n  &lt;span class=&quot;na&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/admin/config/system/example/{example}&#39;&lt;/span&gt;\n  &lt;span class=&quot;na&quot;&gt;defaults&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n    &lt;span class=&quot;na&quot;&gt;_entity_form&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;example.edit&#39;&lt;/span&gt;\n    &lt;span class=&quot;na&quot;&gt;_title&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Edit&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;example&#39;&lt;/span&gt;\n  &lt;span class=&quot;na&quot;&gt;requirements&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n    &lt;span class=&quot;na&quot;&gt;_permission&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;administer&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;site&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;configuration&#39;&lt;/span&gt;\n\n&lt;span class=&quot;na&quot;&gt;entity.example.delete_form&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n  &lt;span class=&quot;na&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/admin/config/system/example/{example}/delete&#39;&lt;/span&gt;\n  &lt;span class=&quot;na&quot;&gt;defaults&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n    &lt;span class=&quot;na&quot;&gt;_entity_form&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;example.delete&#39;&lt;/span&gt;\n    &lt;span class=&quot;na&quot;&gt;_title&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Delete&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;example&#39;&lt;/span&gt;\n  &lt;span class=&quot;na&quot;&gt;requirements&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n    &lt;span class=&quot;na&quot;&gt;_permission&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;administer&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;site&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;configuration&#39;&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;\n\n&lt;h3 id=&quot;定义菜单&quot;&gt;定义菜单&lt;/h3&gt;\n\n&lt;p&gt;在 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;example/example.links.action.yml&lt;/code&gt; 定义一个添加按钮。&lt;/p&gt;\n\n&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n4\n5\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;na&quot;&gt;entity.example.add_form&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n  &lt;span class=&quot;na&quot;&gt;route_name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;entity.example.add_form&#39;&lt;/span&gt;\n  &lt;span class=&quot;na&quot;&gt;title&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Add&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;example&#39;&lt;/span&gt;\n  &lt;span class=&quot;na&quot;&gt;appears_on&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;entity.example.collection&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;\n\n&lt;h3 id=&quot;实体类型类&quot;&gt;实体类型类&lt;/h3&gt;\n\n&lt;ol&gt;\n  &lt;li&gt;\n    &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;example/src/ExampleInterface.php&lt;/code&gt;&lt;/p&gt;\n\n    &lt;p&gt;假设实体里面包含一些属性, 需要在接口实现 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;set/get&lt;/code&gt; 方法。如&#58;&lt;/p&gt;\n\n    &lt;div class=&quot;language-php highlighter-rouge&quot;&gt;\n&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt; &lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;\n &lt;span class=&quot;kn&quot;&gt;namespace&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Drupal\\example&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n\n &lt;span class=&quot;kn&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Drupal\\Core\\Config\\Entity\\Config\\EntityInterface&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n\n &lt;span class=&quot;cd&quot;&gt;/**\n  * Provides an interface defining on Example entity.\n */&lt;/span&gt;\n &lt;span class=&quot;kd&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ExampleInterface&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ConfigEntityInterface&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;\n   &lt;span class=&quot;c1&quot;&gt;// Add get/set methods for your configuration properties here.&lt;/span&gt;\n &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;\n  &lt;/li&gt;\n  &lt;li&gt;\n    &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;example/src/Entity/Example.php&lt;/code&gt;&lt;/p&gt;\n\n    &lt;p&gt;这个文件定义了配置类型的实现类。&lt;/p&gt;\n\n    &lt;div class=&quot;language-php highlighter-rouge&quot;&gt;\n&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt; &lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;\n &lt;span class=&quot;kn&quot;&gt;namespace&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Drupal\\example\\Entity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n\n &lt;span class=&quot;kn&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Drupal\\Core\\Config\\Entity\\ConfigEntityBase&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n &lt;span class=&quot;kn&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Drupal\\example\\ExampleInterface&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n\n &lt;span class=&quot;cd&quot;&gt;/**\n  * Defines the Example entity\n *\n * @ConfigEntityType(\n *   id = &quot;example&quot;,\n *   label = @Translation(&quot;Example&quot;),\n *   handlers = {\n *     &quot;list_builder&quot; = &quot;Drupal\\example\\Controller\\ExampleListBuilder&quot;,\n *     &quot;form&quot; = {\n *       &quot;add&quot; = &quot;Drupal\\example\\Form\\ExampleForm&quot;,\n *       &quot;edit&quot; = &quot;Drupal\\example\\Form\\ExampleForm&quot;,\n *       &quot;delete&quot; = &quot;Drupal\\example\\Form\\ExampleDeleteForm&quot;,\n *     },\n *     config_prefix = &quot;example&quot;,\n *     admin_permission = &quot;administer site configuration&quot;,\n *     entity_keys = {\n *       &quot;id&quot; = &quot;id&quot;,\n *       &quot;label&quot; = &quot;label&quot;,\n *     },\n *     links = {\n *       &quot;edit-form&quot; = &quot;/admin/config/system/example/{example}&quot;,\n *       &quot;delete-form&quot; = &quot;/admin/config/system/example/{example}/delete&quot;,\n *     }\n *   }\n * )\n */&lt;/span&gt;\n &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Example&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ConfigEntityBase&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ExampleInterface&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;\n\n   &lt;span class=&quot;cd&quot;&gt;/**\n    * The Example ID.\n    *\n    * @var string\n    */&lt;/span&gt;\n   &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n\n   &lt;span class=&quot;cd&quot;&gt;/**\n    * The Example label.\n    *\n    * @var string\n    */&lt;/span&gt;\n   &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n\n   &lt;span class=&quot;c1&quot;&gt;// Your specific configuration property get/set methods go here,&lt;/span&gt;\n   &lt;span class=&quot;c1&quot;&gt;// implementing the interface.&lt;/span&gt;\n\n &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;\n  &lt;/li&gt;\n&lt;/ol&gt;\n\n&lt;h3 id=&quot;配置-schema&quot;&gt;配置 schema&lt;/h3&gt;\n\n&lt;p&gt;文件&#58; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;example/config/schema/example.schema.yml&lt;/code&gt;&lt;/p&gt;\n\n&lt;p&gt;在 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\\Drupal\\example\\Entity\\Example&lt;/code&gt; 中定义的属性添加到这里。&lt;/p&gt;\n\n&lt;p&gt;注意&#58; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ConfigEntityType&lt;/code&gt; 注解里的 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;config_prefix&lt;/code&gt; 字段必须跟 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;schema&lt;/code&gt; 的 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;prefix&lt;/code&gt; 一致。&lt;/p&gt;\n\n&lt;p&gt;比如你定义的 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;config_prefix&lt;/code&gt; 是这样的&#58; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;config_prefix = &quot;variable_name&quot;&lt;/code&gt;&lt;/p&gt;\n\n&lt;p&gt;那么 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;schema&lt;/code&gt; 的格式必须是&#58; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;example.variable_name.*&lt;/code&gt;&lt;/p&gt;\n\n&lt;p&gt;这里我们定义的 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;config_prefix&lt;/code&gt; 是 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;example&lt;/code&gt;, 因此&lt;/p&gt;\n\n&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;na&quot;&gt;example.example.*&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n  &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;config_entity&lt;/span&gt;\n  &lt;span class=&quot;na&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Example&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;config&#39;&lt;/span&gt;\n  &lt;span class=&quot;na&quot;&gt;mapping&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n    &lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n      &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;string&lt;/span&gt;\n      &lt;span class=&quot;na&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;ID&#39;&lt;/span&gt;\n    &lt;span class=&quot;na&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n      &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;label&lt;/span&gt;\n      &lt;span class=&quot;na&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Label&#39;&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;\n\n&lt;h3 id=&quot;实体-controller&quot;&gt;实体 controller&lt;/h3&gt;\n\n&lt;ol&gt;\n  &lt;li&gt;\n    &lt;p&gt;文件&#58; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;example/src/Form/ExampleForm.php&lt;/code&gt;&lt;/p&gt;\n\n    &lt;div class=&quot;language-php highlighter-rouge&quot;&gt;\n&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt; &lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;\n &lt;span class=&quot;kn&quot;&gt;namespace&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Drupal\\example\\Form&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n\n &lt;span class=&quot;kn&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Drupal\\Core\\Entity\\EntityForm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n &lt;span class=&quot;kn&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Drupal\\Core\\Entity\\Query\\QueryFactory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n &lt;span class=&quot;kn&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Drupal\\Core\\Form\\FormStateInterface&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n &lt;span class=&quot;kn&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Symfony\\Component\\DependencyInjection\\ContainerInterface&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n\n &lt;span class=&quot;cd&quot;&gt;/**\n  * Form handler for the Example add and edit forms.\n */&lt;/span&gt;\n &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ExampleForm&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;EntityForm&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;\n\n   &lt;span class=&quot;cd&quot;&gt;/**\n    * Constructs on ExampleForm object.\n    *\n    * @param \\Drupal\\Core\\Entity\\Query\\QueryFactory $entity_query\n    *   The entity query.\n    */&lt;/span&gt;\n   &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__construct&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;QueryFactory&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$entity_query&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;\n     &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;entityQuery&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$entity_query&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;\n\n   &lt;span class=&quot;cd&quot;&gt;/**\n    * {@inheritdoc}\n    */&lt;/span&gt;\n   &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;ContainerInterface&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$container&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;\n     &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;static&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;\n       &lt;span class=&quot;nv&quot;&gt;$container&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;entity.query&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;\n     &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;\n\n   &lt;span class=&quot;cd&quot;&gt;/**\n    * {@inheritdoc}\n    */&lt;/span&gt;\n   &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;form&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;array&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$form&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;FormStateInterface&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$form_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;\n     &lt;span class=&quot;nv&quot;&gt;$form&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;parent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&#58;&#58;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;form&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$form&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$form_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n\n     &lt;span class=&quot;nv&quot;&gt;$example&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;entity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n\n     &lt;span class=&quot;nv&quot;&gt;$form&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;label&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;\n       &lt;span class=&quot;s1&quot;&gt;&#39;#type&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;textfield&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;\n       &lt;span class=&quot;s1&quot;&gt;&#39;#title&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;Label&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;\n       &lt;span class=&quot;s1&quot;&gt;&#39;#maxlength&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;\n       &lt;span class=&quot;s1&quot;&gt;&#39;#default_value&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$example&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt;\n       &lt;span class=&quot;s1&quot;&gt;&#39;#description&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;Label for the Example.&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;\n       &lt;span class=&quot;s1&quot;&gt;&#39;#required&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;TRUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;\n     &lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;\n\n     &lt;span class=&quot;nv&quot;&gt;$form&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;id&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;\n       &lt;span class=&quot;s1&quot;&gt;&#39;#type&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;machine_name&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;\n       &lt;span class=&quot;s1&quot;&gt;&#39;#default_value&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$example&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt;\n       &lt;span class=&quot;s1&quot;&gt;&#39;#machine_name&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;\n           &lt;span class=&quot;s1&quot;&gt;&#39;exists&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;exist&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;\n       &lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;\n       &lt;span class=&quot;s1&quot;&gt;&#39;#disabled&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$example&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;isNew&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt;\n     &lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;\n\n     &lt;span class=&quot;c1&quot;&gt;// You will need additional form elements for your custom properties.&lt;/span&gt;\n     &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$form&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;\n\n   &lt;span class=&quot;cd&quot;&gt;/**\n    * {@inheritdoc}\n    */&lt;/span&gt;\n   &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;array&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$form&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;FormStateInterface&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$form_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;\n     &lt;span class=&quot;nv&quot;&gt;$example&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;entity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n     &lt;span class=&quot;nv&quot;&gt;$status&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$example&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;\n\n     &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;\n       &lt;span class=&quot;nf&quot;&gt;drupal_set_message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;Save the %label Example.&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;\n         &lt;span class=&quot;s1&quot;&gt;&#39;%label&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$example&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt;\n       &lt;span class=&quot;p&quot;&gt;]));&lt;/span&gt;\n     &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;\n       &lt;span class=&quot;nf&quot;&gt;drupal_set_message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;The %label Example was not saved.&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;\n         &lt;span class=&quot;s1&quot;&gt;&#39;%label&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$example&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt;\n       &lt;span class=&quot;p&quot;&gt;]));&lt;/span&gt;\n     &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;\n     &lt;span class=&quot;nv&quot;&gt;$form_state&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;setRedirect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;entity.example.collection&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;\n\n   &lt;span class=&quot;cd&quot;&gt;/**\n    * Helper function check whether an Example configuration entity exists.\n    */&lt;/span&gt;\n   &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;\n     &lt;span class=&quot;nv&quot;&gt;$entity&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;entityQuery&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;example&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;\n       &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;condition&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;id&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;\n       &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;execute&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;\n     &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$entity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;\n\n &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;\n  &lt;/li&gt;\n  &lt;li&gt;\n    &lt;p&gt;文件&#58; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;example/src/Controller/ExampleListBuilder.php&lt;/code&gt;&lt;/p&gt;\n\n    &lt;div class=&quot;language-php highlighter-rouge&quot;&gt;\n&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt; &lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;\n &lt;span class=&quot;kn&quot;&gt;namespace&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Drupal\\example\\Controller&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n\n &lt;span class=&quot;kn&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Drupal\\Core\\Config\\Entity\\ConfigEntityListBuilder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n &lt;span class=&quot;kn&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Drupal\\Core\\Entity\\EntityInterface&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n\n &lt;span class=&quot;cd&quot;&gt;/**\n  * Provides a listing of Example.\n */&lt;/span&gt;\n &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ExampleListBuilder&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ConfigEntityListBuilder&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;\n\n   &lt;span class=&quot;cd&quot;&gt;/**\n    * {@inheritdoc}\n    */&lt;/span&gt;\n   &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buildHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;\n     &lt;span class=&quot;nv&quot;&gt;$header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;label&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;Example&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n     &lt;span class=&quot;nv&quot;&gt;$header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;id&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;Machine name&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n     &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$header&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;parent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&#58;&#58;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;buildHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;\n   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;\n\n   &lt;span class=&quot;cd&quot;&gt;/**\n    * {@inheritdoc}\n    */&lt;/span&gt;\n   &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buildRow&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;EntityInterface&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$entity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;\n     &lt;span class=&quot;nv&quot;&gt;$row&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;label&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;getLabel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$entity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n     &lt;span class=&quot;nv&quot;&gt;$row&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;id&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$entity&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;\n\n     &lt;span class=&quot;c1&quot;&gt;// You probably want a few more properties here ...&lt;/span&gt;\n\n     &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$row&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;parent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&#58;&#58;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;buildRow&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$entity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;\n\n &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;\n  &lt;/li&gt;\n  &lt;li&gt;\n    &lt;p&gt;文件&#58; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;example/src/Form/ExampleDeleteForm&lt;/code&gt;&lt;/p&gt;\n\n    &lt;div class=&quot;language-php highlighter-rouge&quot;&gt;\n&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt; &lt;span class=&quot;kn&quot;&gt;namespace&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Drupal\\example\\Form&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n\n &lt;span class=&quot;kn&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Drupal\\Core\\Entity\\EntityConfirmFormBase&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n &lt;span class=&quot;kn&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Drupal\\Core\\Url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n &lt;span class=&quot;kn&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Drupal\\Core\\Form\\FormStateInterface&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n\n &lt;span class=&quot;cd&quot;&gt;/**\n  * Builds the form to delete an Example.\n */&lt;/span&gt;\n &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ExampleDeleteForm&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;EntityConfirmFormBase&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;\n\n   &lt;span class=&quot;cd&quot;&gt;/**\n    * {@inheritdoc}\n    */&lt;/span&gt;\n   &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getQuestion&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;\n     &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;Are you sure you want to delete %name?&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;\n       &lt;span class=&quot;s1&quot;&gt;&#39;%name&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;entity&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt;\n     &lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;\n   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;\n\n   &lt;span class=&quot;cd&quot;&gt;/**\n    * {@inheritdoc}\n    */&lt;/span&gt;\n   &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getCancelUrl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;\n     &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;entity.example.collection&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;\n\n   &lt;span class=&quot;cd&quot;&gt;/**\n    * {@inheritdoc}\n    */&lt;/span&gt;\n   &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getConfirmText&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;\n     &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;Delete&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;\n\n   &lt;span class=&quot;cd&quot;&gt;/**\n    * {@inheritdoc}\n    */&lt;/span&gt;\n   &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;submitForm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;array&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$form&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;FormStateInterface&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$form_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;\n     &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;entity&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;\n     &lt;span class=&quot;nf&quot;&gt;drupal_set_message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;Category %label has been deleted.&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;\n       &lt;span class=&quot;s1&quot;&gt;&#39;%label&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;entity&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt;\n     &lt;span class=&quot;p&quot;&gt;]));&lt;/span&gt;\n     &lt;span class=&quot;nv&quot;&gt;$form_state&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;setRedirectUrl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;getCancelUrl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;\n   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;\n\n &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;\n  &lt;/li&gt;\n&lt;/ol&gt;\n\n&lt;h2 id=&quot;配置-api-示例&quot;&gt;配置 API 示例&lt;/h2&gt;\n\n&lt;h3 id=&quot;读取配置&quot;&gt;读取配置&lt;/h3&gt;\n\n&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n4\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;c1&quot;&gt;// Immutable Config (Read Only)&lt;/span&gt;\n&lt;span class=&quot;nv&quot;&gt;$config&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Drupal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&#58;&#58;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;system.performance&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n&lt;span class=&quot;c1&quot;&gt;// Mutable Config (Read / Write)&lt;/span&gt;\n&lt;span class=&quot;nv&quot;&gt;$config&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Drupal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&#58;&#58;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;service&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;config.factory&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;getEditable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;system.performance&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;\n\n&lt;p&gt;第一个只读, 第二个方法可读写。&lt;/p&gt;\n\n&lt;p&gt;配置读取一般使用 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;get&lt;/code&gt; 方法, 如&#58;&lt;/p&gt;\n\n&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$config&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Drupal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&#58;&#58;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;system.maintenance&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n&lt;span class=&quot;nv&quot;&gt;$message&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$config&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;message&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;\n\n&lt;p&gt;也可以改成链式写法&#58;&lt;/p&gt;\n\n&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$message&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Drupal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&#58;&#58;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;system.maintenance&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;message&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;\n\n&lt;p&gt;读取一个嵌套配置, 使用 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.&lt;/code&gt; 号连接起来。如&#58;&lt;/p&gt;\n\n&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$enabled&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Drupal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&#58;&#58;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;system.performance&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;cache.page.enabled&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;\n\n&lt;h3 id=&quot;写入配置&quot;&gt;写入配置&lt;/h3&gt;\n\n&lt;p&gt;通常使用 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;getEditable&lt;/code&gt; 这个方法从 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\\Drupal\\Core\\Config\\Config&lt;/code&gt; 中获取。如&#58;&lt;/p&gt;\n\n&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nc&quot;&gt;Drupal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&#58;&#58;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;service&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;config.factory&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;getEditable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;system.performance&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;\n\n&lt;h4 id=&quot;覆写单个配置&quot;&gt;覆写单个配置&lt;/h4&gt;\n\n&lt;p&gt;一般使用 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;set&lt;/code&gt; 和 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;save&lt;/code&gt; 方法来变更配置。如&#58;&lt;/p&gt;\n\n&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$config&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Drupal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&#58;&#58;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;service&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;config.factory&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;getEditable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;system.performance&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n\n&lt;span class=&quot;c1&quot;&gt;// Set a scalar value.&lt;/span&gt;\n&lt;span class=&quot;nv&quot;&gt;$config&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;cache.page.enabled&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n\n&lt;span class=&quot;c1&quot;&gt;// Set an array of values.&lt;/span&gt;\n&lt;span class=&quot;nv&quot;&gt;$page_cache_data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;\n  &lt;span class=&quot;s1&quot;&gt;&#39;enabled&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;\n  &lt;span class=&quot;s1&quot;&gt;&#39;max_age&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;\n&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;\n&lt;span class=&quot;nv&quot;&gt;$config&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;cache.page&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$page_cache_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n\n&lt;span class=&quot;c1&quot;&gt;// Save your data to the file system.&lt;/span&gt;\n&lt;span class=&quot;nv&quot;&gt;$config&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;\n\n&lt;p&gt;也可以写成链式&#58;&lt;/p&gt;\n\n&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n4\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nc&quot;&gt;Drupal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&#58;&#58;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;service&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;config.factory&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;\n  &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;getEditable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;system.performance&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;\n  &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;cache.page.enabled&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;\n  &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;\n\n&lt;h4 id=&quot;覆写所有配置&quot;&gt;覆写所有配置&lt;/h4&gt;\n\n&lt;p&gt;如果要覆盖所有的配置数据, 可以使用 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;setData&lt;/code&gt; 方法, 代码如下&#58;&lt;/p&gt;\n\n&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;c1&quot;&gt;// Set all values.&lt;/span&gt;\n&lt;span class=&quot;err&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Drupal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&#58;&#58;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;service&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;config.factory&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;\n  &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;getEditable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;system.performance&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;\n  &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;setData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;\n      &lt;span class=&quot;s1&quot;&gt;&#39;cache&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;\n        &lt;span class=&quot;s1&quot;&gt;&#39;page&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;\n          &lt;span class=&quot;s1&quot;&gt;&#39;enabled&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;0&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;\n          &lt;span class=&quot;s1&quot;&gt;&#39;max_age&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;0&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;\n        &lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;\n      &lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;\n      &lt;span class=&quot;s1&quot;&gt;&#39;preprocess&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;\n        &lt;span class=&quot;s1&quot;&gt;&#39;css&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;0&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;\n        &lt;span class=&quot;s1&quot;&gt;&#39;js&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;0&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;\n      &lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;\n      &lt;span class=&quot;s1&quot;&gt;&#39;response&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;\n        &lt;span class=&quot;s1&quot;&gt;&#39;gzip&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;0&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;\n      &lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;\n  &lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;\n  &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;\n\n&lt;p&gt;注意&#58; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;setData&lt;/code&gt; 会完全改变配置的数据结构, 务必更改的时候对应好键值。&lt;/p&gt;\n\n&lt;h3 id=&quot;删除配置&quot;&gt;删除配置&lt;/h3&gt;\n\n&lt;h4 id=&quot;删除一个单独的配置&quot;&gt;删除一个单独的配置&lt;/h4&gt;\n\n&lt;p&gt;代码如下&#58;&lt;/p&gt;\n\n&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$config&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Drupal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&#58;&#58;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;service&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;config.facotry&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;getEditable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;system.performance&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n&lt;span class=&quot;nv&quot;&gt;$config&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;clear&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;cache.page.max_age&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;\n&lt;span class=&quot;nv&quot;&gt;$page_cache_data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$config&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;cache.page&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;\n\n&lt;p&gt;这时候打印 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$page_cache_data&lt;/code&gt;, 会发现 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;max_age&lt;/code&gt; 已经被删除了。&lt;/p&gt;\n\n&lt;h4 id=&quot;删除所有配置&quot;&gt;删除所有配置&lt;/h4&gt;\n\n&lt;p&gt;通常使用 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;delete&lt;/code&gt; 方法, 代码如下&#58;&lt;/p&gt;\n\n&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nc&quot;&gt;Drupal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&#58;&#58;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;service&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;config.factory&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;getEditable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;system.performance&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;\n\n&lt;h3 id=&quot;最佳实践&quot;&gt;最佳实践&lt;/h3&gt;\n\n&lt;p&gt;如果要在一个配置里保存多个字段, 我们可能要写多个 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;save&lt;/code&gt;, 如下&#58;&lt;/p&gt;\n\n&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nc&quot;&gt;Drupal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&#58;&#58;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;service&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;config.factory&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;getEditable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;foo.bar&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;foo&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;foo&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;\n&lt;span class=&quot;err&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Drupal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&#58;&#58;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;service&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;config.factory&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;getEditable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;foo.bar&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;bar&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;bar&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;\n\n&lt;p&gt;这种代码是不合理的, 应该写成&#58;&lt;/p&gt;\n\n&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n4\n5\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$config&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Drupal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&#58;&#58;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;service&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;config.factory&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;getEditable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;foo.bar&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n&lt;span class=&quot;nv&quot;&gt;$config&lt;/span&gt;\n  &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;foo&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;foo&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;\n  &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;bar&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;bar&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;\n  &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;\n\n&lt;h2 id=&quot;如何更改配置&quot;&gt;如何更改配置&lt;/h2&gt;\n\n&lt;p&gt;如何更改我们在 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;{module.settings.yml}&lt;/code&gt; 定义的配置呢？&lt;/p&gt;\n\n&lt;p&gt;通常我们通过 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;form&lt;/code&gt; 表单来实现。&lt;/p&gt;\n\n&lt;ol&gt;\n  &lt;li&gt;\n    &lt;p&gt;文件&#58; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;example/config/install/example.settings.yml&lt;/code&gt;&lt;/p&gt;\n\n    &lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;\n&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt; &lt;span class=&quot;na&quot;&gt;things&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;thingssss&lt;/span&gt;\n &lt;span class=&quot;na&quot;&gt;other_things&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;other_thingssss&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;\n  &lt;/li&gt;\n  &lt;li&gt;\n    &lt;p&gt;文件&#58; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;example/src/Form/exampleSettingsForm.php&lt;/code&gt;&lt;/p&gt;\n\n    &lt;div class=&quot;language-php highlighter-rouge&quot;&gt;\n&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt; &lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;\n &lt;span class=&quot;kn&quot;&gt;namespace&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Drupal\\example\\Form&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n\n &lt;span class=&quot;kn&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Drupal\\Core\\Form\\ConfigFormBase&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n &lt;span class=&quot;kn&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Drupal\\Core\\Form\\FormStateInterface&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n\n &lt;span class=&quot;cd&quot;&gt;/**\n  * Configure example settings for this site.\n */&lt;/span&gt;\n &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;exampleSettingsForm&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ConfigFormBase&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;\n\n   &lt;span class=&quot;cd&quot;&gt;/**\n    * {@inheritdoc}\n    */&lt;/span&gt;\n   &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getFormId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;\n     &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;example_admin_settings&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;\n   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;\n\n   &lt;span class=&quot;cd&quot;&gt;/**\n    * {@inheritdoc}\n    */&lt;/span&gt;\n   &lt;span class=&quot;k&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getEditableConfigNames&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;\n     &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;\n       &lt;span class=&quot;s1&quot;&gt;&#39;example.settings&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;\n     &lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;\n   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;\n\n   &lt;span class=&quot;cd&quot;&gt;/**\n    * {@inheritdoc}\n    */&lt;/span&gt;\n   &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buildForm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;array&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$form&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;FormStateInterface&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$form_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;\n     &lt;span class=&quot;nv&quot;&gt;$config&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;example.settings&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n\n     &lt;span class=&quot;nv&quot;&gt;$form&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;example_thing&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;\n       &lt;span class=&quot;s1&quot;&gt;&#39;#type&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;textfield&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;\n       &lt;span class=&quot;s1&quot;&gt;&#39;#title&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;Things&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n       &lt;span class=&quot;s1&quot;&gt;&#39;#default_value&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$config&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;things&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n     &lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;\n\n     &lt;span class=&quot;nv&quot;&gt;$form&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;other_things&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;\n       &lt;span class=&quot;s1&quot;&gt;&#39;#type&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;textfield&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;\n       &lt;span class=&quot;s1&quot;&gt;&#39;#title&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;Other things&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;\n       &lt;span class=&quot;s1&quot;&gt;&#39;#default_value&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$config&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;other_things&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;\n     &lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;\n\n     &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;parent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&#58;&#58;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;buildForm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$form&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$form_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;\n\n   &lt;span class=&quot;cd&quot;&gt;/**\n    * {@inheritdoc}\n    */&lt;/span&gt;\n   &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;submitForm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;array&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$form&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;FormStateInterface&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$form_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;\n     &lt;span class=&quot;c1&quot;&gt;// Retrieve the configuration&lt;/span&gt;\n     &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;example.settings&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;\n       &lt;span class=&quot;c1&quot;&gt;// Set the submitted configuration setting&lt;/span&gt;\n       &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;things&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$form_state&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;getValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;example_thing&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;\n       &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;other_things&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$form_state&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;getValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;other_things&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;\n       &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;\n\n     &lt;span class=&quot;k&quot;&gt;parent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&#58;&#58;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;submitForm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$form&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$form_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;\n\n &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;\n  &lt;/li&gt;\n  &lt;li&gt;\n    &lt;p&gt;文件&#58; example/example.routing.yml&lt;/p&gt;\n\n    &lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;\n&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1\n2\n3\n4\n5\n6\n7\n&lt;/pre&gt;&lt;/td&gt;\n&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt; &lt;span class=&quot;na&quot;&gt;example.settings&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n   &lt;span class=&quot;na&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/admin/structure/example/settings&#39;&lt;/span&gt;\n   &lt;span class=&quot;na&quot;&gt;defaults&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n     &lt;span class=&quot;na&quot;&gt;_form&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\\Drupal\\example\\Form\\exampleSettingsForm&#39;&lt;/span&gt;\n     &lt;span class=&quot;na&quot;&gt;_title&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;example&#39;&lt;/span&gt;\n   &lt;span class=&quot;na&quot;&gt;requirements&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt;\n     &lt;span class=&quot;na&quot;&gt;_permission&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;&#58;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;administer&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;site&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;configuration&#39;&lt;/span&gt;\n&lt;/pre&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;\n  &lt;/li&gt;\n&lt;/ol&gt;\n\n&lt;p&gt;以上代码已经很清晰的说明了如何通过 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;form&lt;/code&gt; 表单来更改默认的配置。&lt;/p&gt;\n\n&lt;h2 id=&quot;实践&quot;&gt;实践&lt;/h2&gt;\n\n&lt;ol&gt;\n  &lt;li&gt;按照讲义进行练习&lt;/li&gt;\n  &lt;li&gt;设计一个配置, 可配置性别、类型（企业、个人、代理等）, 等至少列举5项, 需使用动态 schema&lt;/li&gt;\n  &lt;li&gt;以上配置都可以在 form 表单里更改&lt;/li&gt;\n  &lt;li&gt;更改一个系统配置&lt;/li&gt;\n&lt;/ol&gt;\n\n&lt;p&gt;以上, 自由发挥。&lt;/p&gt;\n",
  "url": "https://www.oscaner.com/skill/php/drupal-config.html"
}
</script>




    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <!-- SNS Link -->
                


<ul class="list-inline text-center">


  
  
  
  <li>
    <a target="_blank" href="https://www.zhihu.com/people/oscaner">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa  fa-stack-1x fa-inverse">知</i>
      </span>
    </a>
  </li>
  
  
  <li>
    <a target="_blank" href="http://weibo.com/Oscaner">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
  
  <li>
    <a target="_blank" href="https://github.com/Oscaner">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
  
  <li>
    <a target="_blank" href="https://space.bilibili.com/17118231">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-stack-1x fa-inverse iconfont icon-bilibili-fill"></i>
      </span>
    </a>
  </li>
  
</ul>


                <p class="copyright text-muted">
                    Copyright © Oscaner 2023
                    <a href="https://beian.miit.gov.cn" target="_blank">浙ICP备17039697号-2</a>
                    <br>
                    Powered by <a href="https://www.oscaner.com">Oscaner Blog</a> |
                    <iframe style="margin-left: 2px; margin-bottom:-5px;" frameborder="0" scrolling="0" width="100px" height="20px" src="https://ghbtns.com/github-btn.html?user=oscaner&repo=oscaner.github.io&type=star&count=true">
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/assets/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<!-- Currently, only navbar scroll-down effect at desktop still depends on this -->
<script src="/assets/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/assets/js/hux-blog.min.js"></script>

<!-- Simple Jekyll Search -->
<script src="/assets/js/simple-jekyll-search.min.js"></script>

<!-- Service Worker -->

<script src="/assets/js/snackbar.js"></script>
<script src="/assets/js/sw-registration.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
        var d = document, t = 'script',
            o = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        o.src = u;
        if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
        s.parentNode.insertBefore(o, s);
    }
</script>

<!--
     Because of the native support for backtick-style fenced code blocks
     right within the Markdown is landed in Github Pages,
     From V1.6, There is no need for Highlight.js,
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/
     - https://github.com/jneen/rouge/wiki/list-of-supported-languages-and-lexers
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->







<!--fastClick.js -->
<script>
    async('/packages/fastclick/1.0.6/fastclick.min.js', function () {
        var $nav = document.querySelector("nav");
        if ($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->

<script>
    // dynamic User by Oscaner
    var _gaId = '';
    var _gaDomain = 'www.oscaner.com';

    // Originial
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
            m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>


<!-- Baidu Tongji -->

<script>
    // dynamic User by Oscaner
    var _baId = 'd9c74d9266af4d68f376f0fb9d5fb71c';

    // Originial
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?" + _baId;
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>



<!-- Side Catalog -->

<script type="text/javascript">
    function generateCatalog(selector) {

        // interop with multilangual
        if ('false' == 'true') {
            _containerSelector = 'div.post-container.active';
        } else {
            _containerSelector = 'div.post-container';
        }

        if (!$(_containerSelector).length) {
            _containerSelector = 'div.post-container';
        }

        // init
        var P = $(_containerSelector), a, n, t, l, i, c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        // clean
        $(selector).html('')

        // appending
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#" + $(this).prop('id');
            t = $(this).text();
            c = $('<a href="' + i + '" rel="nofollow">' + t + '</a>');
            l = $('<li class="' + n + '_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function (e) {
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    /*
     * Doc: https://github.com/davist11/jQuery-One-Page-Nav
     * Fork by Hux to support padding
     */
    async("/assets/js/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>



<!-- Multi-Lingual -->


<!-- Simple Jekyll Search -->
<script>
    // https://stackoverflow.com/questions/1912501/unescape-html-entities-in-javascript
    function htmlDecode(input) {
        var e = document.createElement('textarea');
        e.innerHTML = input;
        // handle case of empty input
        return e.childNodes.length === 0 ? "" : e.childNodes[0].nodeValue;
    }

    SimpleJekyllSearch({
        searchInput: document.getElementById('search-input'),
        resultsContainer: document.getElementById('search-results'),
        json: '/search.json',
        searchResultTemplate: '<div class="post-preview item"><a href="{url}"><h2 class="post-title">{title}</h2><h3 class="post-subtitle">{subtitle}</h3><hr></a></div>',
        noResultsText: 'No results',
        limit: 50,
        fuzzy: false,
        // a hack to get escaped subtitle unescaped. for some reason,
        // post.subtitle w/o escape filter nuke entire search.
        templateMiddleware: function (prop, value, template) {
            if (prop === 'subtitle' || prop === 'title') {
                if (value.indexOf("code")) {
                    return htmlDecode(value);
                } else {
                    return value;
                }
            }
        }
    });

    $(document).ready(function () {
        var $searchPage = $('.search-page');
        var $searchOpen = $('.search-icon');
        var $searchClose = $('.search-icon-close');
        var $searchInput = $('#search-input');
        var $body = $('body');

        $searchOpen.on('click', function (e) {
            e.preventDefault();
            $searchPage.toggleClass('search-active');
            var prevClasses = $body.attr('class') || '';
            setTimeout(function () {
                $body.addClass('no-scroll');
            }, 400)

            if ($searchPage.hasClass('search-active')) {
                $searchClose.on('click', function (e) {
                    e.preventDefault();
                    $searchPage.removeClass('search-active');
                    $body.attr('class', prevClasses);  // from closure
                });
                $searchInput.focus();
            }
        });
    });
</script>



<!-- Image to hack wechat -->
<img src="/assets/img/icon_wechat.png" width="0" height="0">
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
